<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Masraf Formu - FLOConnect</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* User Badge - Standardized */
        .user-badge {
            background: linear-gradient(135deg, var(--primary-orange), var(--primary-burgundy));
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-top: 8px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">â˜°</button>
        <div class="logo">FLO<span style="font-weight: 300;">Connect</span></div>
        <div class="header-actions">
            <div class="notification-wrapper">
                <button class="notification-btn" onclick="toggleNotifications()">
                    ğŸ”” Bildirimler
                    <span class="notification-badge">3</span>
                </button>
                <div class="notification-dropdown" id="notificationDropdown">
                    <div class="notification-header">
                        <h3>Bildirimler</h3>
                        <div class="notification-header-actions">
                            <button class="mark-all-read" onclick="markAllNotificationsRead()">TÃ¼mÃ¼nÃ¼ okundu iÅŸaretle</button>
                        </div>
                    </div>
                    <div class="notification-list" id="notificationList">
                        <!-- JavaScript ile doldurulacak -->
                    </div>
                    <div class="notification-footer">
                        <a href="bildirimler.html">TÃ¼m bildirimleri gÃ¶rÃ¼ntÃ¼le</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" onclick="closeMobileMenu()"></div>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar - Employee View -->
        <aside class="sidebar" id="sidebarEmployee">
            <button class="sidebar-close" onclick="closeMobileMenu()">âœ•</button>
            <div class="user-profile">
                <div class="user-avatar">BT</div>
                <div class="user-name">Berat TanrÄ±verdi</div>
                <div class="user-title">KÄ±demli Uzman</div>
                <div class="user-role">ÃœrÃ¼n TasarÄ±m/UX MÃ¼d.</div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="calisan-anasayfa.html" class="nav-link">
                        <span class="nav-icon">ğŸ </span>
                        Anasayfa
                    </a>
                </li>
                <li class="nav-item">
                    <a href="masraf-formu.html" class="nav-link active">
                        <span class="nav-icon">ğŸ§¾</span>
                        Yeni Masraf GiriÅŸi
                    </a>
                </li>
                <li class="nav-item">
                    <a href="masraf-listesi.html" class="nav-link">
                        <span class="nav-icon">ğŸ“‹</span>
                        Masraf Taleplerim
                    </a>
                </li>
            </ul>

            <button class="logout-btn" onclick="window.location.href='index.html'">
                ğŸšª Ã‡Ä±kÄ±ÅŸ Yap
            </button>
        </aside>

        <!-- Sidebar - Manager View -->
        <aside class="sidebar" id="sidebarManager" style="display: none;">
            <button class="sidebar-close" onclick="closeMobileMenu()">âœ•</button>
            <div class="user-profile">
                <div class="user-avatar">MY</div>
                <div class="user-name">Mehmet YÄ±lmaz</div>
                <div class="user-title">Dijital ÃœrÃ¼nler DirektÃ¶rÃ¼</div>
                <div class="user-badge">4. Derece Onay Yetkisi</div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="yonetici-anasayfa.html" class="nav-link">
                        <span class="nav-icon">ğŸ </span>
                        Anasayfa
                    </a>
                </li>
                <li class="nav-item">
                    <a href="onay-listesi.html" class="nav-link">
                        <span class="nav-icon">â³</span>
                        Onay Bekleyenler
                        <span style="background: var(--warning-red); color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: auto;">7</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="masraf-listesi.html?view=all" class="nav-link">
                        <span class="nav-icon">ğŸ“‹</span>
                        MasraflarÄ±m
                        <span style="background: var(--primary-orange); color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: auto;">5</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="masraf-listesi.html?view=team" class="nav-link">
                        <span class="nav-icon">ğŸ‘¥</span>
                        Ekip MasraflarÄ±
                        <span style="background: var(--text-secondary); color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: auto;">23</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="masraf-formu.html?role=manager" class="nav-link active">
                        <span class="nav-icon">ğŸ§¾</span>
                        Masraf GiriÅŸi
                    </a>
                </li>
            </ul>

            <button class="logout-btn" onclick="window.location.href='index.html'">
                ğŸšª Ã‡Ä±kÄ±ÅŸ Yap
            </button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Alert Container -->
            <div id="alertContainer"></div>

            <!-- Breadcrumb -->
            <div class="breadcrumb">
                <a href="calisan-anasayfa.html">Anasayfa</a>
                <span>â€º</span>
                <span>Yeni Masraf GiriÅŸi</span>
            </div>

            <h1 class="page-title">Yeni Masraf GiriÅŸi</h1>

            <!-- Warning Alert -->
            <div class="alert alert-warning">
                <span class="alert-icon">âš ï¸</span>
                <div>
                    <strong>Ã–nemli:</strong> FiÅŸ veya fatura gÃ¶rselini yÃ¼kleyiniz. OCR sistemi belgenizi otomatik olarak okuyacaktÄ±r.
                    Okunan bilgileri kontrol edip onaylamanÄ±z gerekmektedir.
                </div>
            </div>

            <div class="form-container">
                <!-- Section 1: Belgeler ve Gider Kalemleri -->
                <div class="form-section">
                    <h2 class="section-title">
                        <span class="section-number">1</span>
                        Belgeler ve Gider Kalemleri
                    </h2>

                    <div class="alert alert-info" style="margin-bottom: 20px;">
                        <span class="alert-icon">ğŸ’¡</span>
                        <div>
                            <strong>Ã‡oklu Belge GiriÅŸi:</strong> Tek masraf talebinde birden fazla fiÅŸ/fatura ekleyebilirsiniz.
                            Her belge OCR ile okunur ve gider kalemleri otomatik oluÅŸturulur. Masraf harici satÄ±rlarÄ± Ã§Ä±karabilirsiniz.
                        </div>
                    </div>

                    <!-- YÃ¼klenen Belgeler Container -->
                    <div id="belgelerContainer">
                        <!-- Belgeler buraya dinamik olarak eklenecek -->
                    </div>

                    <!-- Yeni Belge Ekleme AlanÄ± -->
                    <div class="yeni-belge-ekle-alani" id="yeniBelgeEkleAlani" style="background: #f8f9fa; padding: 24px; border-radius: 12px; border: 2px dashed #ccc;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <h4 style="margin: 0 0 8px 0; color: #333;">Yeni Belge Ekle</h4>
                            <p style="margin: 0; color: #666; font-size: 13px;">Ã–nce belge tÃ¼rÃ¼nÃ¼ seÃ§in, sonra belgeyi yÃ¼kleyin</p>
                        </div>

                        <!-- Belge TÃ¼rÃ¼ SeÃ§imi -->
                        <div style="display: flex; gap: 16px; justify-content: center; margin-bottom: 20px;">
                            <label style="display: flex; align-items: center; gap: 8px; padding: 12px 24px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.2s;" id="belgeTuruFisLabel">
                                <input type="radio" name="yeniBelgeTuru" value="fis" checked onchange="belgeTuruDegisti()">
                                <span style="font-size: 20px;">ğŸ§¾</span>
                                <span style="font-weight: 600;">FiÅŸ</span>
                                <span style="font-size: 11px; color: #666;">(Cari gerekmez)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; padding: 12px 24px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.2s;" id="belgeTuruFaturaLabel">
                                <input type="radio" name="yeniBelgeTuru" value="fatura" onchange="belgeTuruDegisti()">
                                <span style="font-size: 20px;">ğŸ“„</span>
                                <span style="font-weight: 600;">Fatura</span>
                                <span style="font-size: 11px; color: #666;">(Cari gerekli)</span>
                            </label>
                        </div>

                        <!-- Dosya YÃ¼kleme -->
                        <div class="file-upload-area" id="uploadArea" style="margin: 0 0 16px 0;">
                            <input type="file" id="fileInput" accept="image/*,.pdf" multiple>
                            <div class="upload-icon">ğŸ“¤</div>
                            <div class="upload-text">Belge YÃ¼kle veya SÃ¼rÃ¼kle</div>
                            <div class="upload-hint">JPG, PNG, PDF - Max 10MB</div>
                        </div>

                        <!-- Demo ve Manuel ButonlarÄ± -->
                        <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                            <button type="button" class="btn-outline" onclick="demoFisEkle()" style="padding: 10px 20px;">
                                ğŸ§¾ Demo FiÅŸ Ekle
                            </button>
                            <button type="button" class="btn-outline" onclick="demoFaturaEkle()" style="padding: 10px 20px;">
                                ğŸ“„ Demo Fatura Ekle
                            </button>
                            <button type="button" class="btn-primary" onclick="manuelBelgeModalAc()" style="padding: 10px 20px; background: linear-gradient(135deg, #9C27B0, #7B1FA2);">
                                âœï¸ Manuel OluÅŸtur
                            </button>
                        </div>
                    </div>

                    <!-- Toplam Ã–zet -->
                    <div id="toplamOzetAlani" style="display: none; margin-top: 24px; padding: 20px; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-radius: 12px; border: 2px solid var(--primary-orange);">
                        <h4 style="margin: 0 0 16px 0; color: var(--primary-orange); font-size: 16px;">ğŸ“Š Toplam Ã–zet</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
                            <div style="background: white; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 12px; color: #666;">Toplam Belge</div>
                                <div style="font-size: 24px; font-weight: 700; color: var(--primary-orange);" id="toplamBelgeSayisi">0</div>
                            </div>
                            <div style="background: white; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 12px; color: #666;">Toplam SatÄ±r</div>
                                <div style="font-size: 24px; font-weight: 700; color: var(--primary-orange);" id="toplamSatirSayisi">0</div>
                            </div>
                            <div style="background: white; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 12px; color: #666;">Net Tutar</div>
                                <div style="font-size: 24px; font-weight: 700; color: #333;" id="toplamNetTutarOzet">â‚º0</div>
                            </div>
                            <div style="background: white; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 12px; color: #666;">KDV TutarÄ±</div>
                                <div style="font-size: 24px; font-weight: 700; color: #2196F3;" id="toplamKdvTutarOzet">â‚º0</div>
                            </div>
                            <div style="background: white; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 12px; color: #666;">Genel Toplam</div>
                                <div style="font-size: 24px; font-weight: 700; color: var(--success-green);" id="toplamBrutTutarOzet">â‚º0</div>
                            </div>
                        </div>
                        <!-- KDV DaÄŸÄ±lÄ±mÄ± -->
                        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(0,0,0,0.1);">
                            <div style="font-size: 13px; color: #666; margin-bottom: 8px;">KDV DaÄŸÄ±lÄ±mÄ±:</div>
                            <div id="kdvDagilimiOzet" style="display: flex; gap: 12px; flex-wrap: wrap;"></div>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Belge Bilgileri (Gizli - eski yapÄ± iÃ§in) -->
                <div class="form-section" id="giderSatirlariSection" style="display: none;">
                    <h2 class="section-title">
                        <span class="section-number">2</span>
                        Okunan Gider SatÄ±rlarÄ±
                    </h2>

                    <div class="alert alert-info" style="margin-bottom: 16px;">
                        <span class="alert-icon">ğŸ“</span>
                        <div>
                            <strong>Gider SatÄ±rÄ± DÃ¼zenleme:</strong> OCR tarafÄ±ndan okunan gider satÄ±rlarÄ±nÄ± gÃ¶rebilir,
                            masrafa konu olmayan satÄ±rlarÄ± Ã§Ä±karabilirsiniz. Her satÄ±rÄ±n KDV oranÄ± farklÄ± olabilir.
                        </div>
                    </div>

                    <div class="gider-satirlari-tablosu">
                        <table class="data-table" id="giderSatirlariTable">
                            <thead>
                                <tr>
                                    <th style="width: 30px;">
                                        <input type="checkbox" id="selectAllRows" onchange="toggleAllRows(this)">
                                    </th>
                                    <th>Gider Kalemi</th>
                                    <th>AÃ§Ä±klama</th>
                                    <th>Hesap Kodu</th>
                                    <th style="text-align: right;">Net Tutar</th>
                                    <th style="text-align: center;">KDV %</th>
                                    <th style="text-align: right;">KDV TutarÄ±</th>
                                    <th style="text-align: right;">BrÃ¼t Tutar</th>
                                    <th style="width: 80px;">Ä°ÅŸlem</th>
                                </tr>
                            </thead>
                            <tbody id="giderSatirlariBody">
                                <!-- JavaScript ile doldurulacak -->
                            </tbody>
                            <tfoot>
                                <tr style="background: #f8f9fa; font-weight: 600;">
                                    <td colspan="4" style="text-align: right;">TOPLAM:</td>
                                    <td style="text-align: right;" id="toplamNetTutar">â‚º0.00</td>
                                    <td style="text-align: center;">-</td>
                                    <td style="text-align: right;" id="toplamKdvTutar">â‚º0.00</td>
                                    <td style="text-align: right; color: var(--primary-orange);" id="toplamBrutTutar">â‚º0.00</td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <div style="display: flex; gap: 12px; margin-top: 16px;">
                        <button type="button" class="btn-secondary" onclick="secilenSatirlariCikar()" id="btnSecilenCikar" disabled>
                            ğŸ—‘ï¸ SeÃ§ilenleri Ã‡Ä±kar
                        </button>
                        <button type="button" class="btn-outline" onclick="yeniGiderSatiriEkle()">
                            â• Manuel SatÄ±r Ekle
                        </button>
                    </div>

                    <!-- KDV Ã–zeti -->
                    <div class="kdv-ozeti" style="margin-top: 20px; padding: 16px; background: #f8f9fa; border-radius: 8px;">
                        <h4 style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">ğŸ“Š KDV OranlarÄ±na GÃ¶re DaÄŸÄ±lÄ±m</h4>
                        <div id="kdvDagilimi" style="display: flex; gap: 16px; flex-wrap: wrap;"></div>
                    </div>
                </div>

                <!-- Section 2: Belge Bilgileri (Dinamik - Gruplu) -->
                <div class="form-section" id="belgeBilgileriSection" style="display: none;">
                    <h2 class="section-title">
                        <span class="section-number">2</span>
                        Belge Bilgileri
                        <span id="belgeBilgileriBadge" style="background: var(--primary-orange); color: white; padding: 2px 10px; border-radius: 12px; font-size: 12px; margin-left: 8px;">0 Belge</span>
                    </h2>

                    <div class="alert alert-info" style="margin-bottom: 16px;">
                        <span class="alert-icon">ğŸ“‹</span>
                        <div>
                            <strong>Belge Ã–zeti:</strong> EklediÄŸiniz tÃ¼m belgelerin bilgileri aÅŸaÄŸÄ±da listelenmiÅŸtir.
                            Faturalar iÃ§in cari durumu otomatik kontrol edilir.
                        </div>
                    </div>

                    <!-- Dinamik Belge Bilgileri Listesi -->
                    <div id="belgeBilgileriListesi">
                        <!-- JavaScript ile doldurulacak -->
                    </div>

                    <!-- Gizli form alanlarÄ± (eski uyumluluk iÃ§in) -->
                    <input type="hidden" id="belgeNo">
                    <input type="hidden" id="belgeTarihi">
                    <input type="hidden" id="firmaAdi">
                    <input type="hidden" id="vergiNo">
                </div>

                <!-- Section 4: Tutar Bilgileri -->
                <div class="form-section">
                    <h2 class="section-title">
                        <span class="section-number">4</span>
                        Tutar Bilgileri
                    </h2>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">BrÃ¼t Tutar (TL)</label>
                            <input type="number" class="form-input" id="brutTutar" step="0.01" placeholder="0.00" oninput="updateAmountSummary()">
                        </div>
                        <div class="form-group">
                            <label class="form-label required">KDV OranÄ± (%)</label>
                            <select class="form-select" id="kdvOrani" onchange="updateAmountSummary()">
                                <option value="0">%0</option>
                                <option value="1">%1</option>
                                <option value="10">%10</option>
                                <option value="20" selected>%20</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">KDV TutarÄ± (TL)</label>
                            <input type="number" class="form-input" id="kdvTutari" step="0.01" readonly style="background: #f5f5f5;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">KDV HariÃ§ Tutar (TL)</label>
                            <input type="number" class="form-input" id="netTutar" step="0.01" readonly style="background: #f5f5f5;">
                        </div>
                    </div>

                    <!-- Tevkifat AlanlarÄ± (TevkifatlÄ± Fatura iÃ§in) -->
                    <div id="tevkifatAlanlari" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required">Tevkifat OranÄ±</label>
                                <select class="form-select" id="tevkifatOrani" onchange="updateTevkifat()">
                                    <option value="0">Tevkifat Yok</option>
                                    <option value="2/10">2/10 - YapÄ±m Ä°ÅŸleri</option>
                                    <option value="4/10">4/10 - Temizlik Hizmetleri</option>
                                    <option value="5/10">5/10 - Makine BakÄ±m</option>
                                    <option value="7/10">7/10 - EtÃ¼t, Plan Proje</option>
                                    <option value="9/10">9/10 - YapÄ± Denetim</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tevkifat TutarÄ± (TL)</label>
                                <input type="number" class="form-input" id="tevkifatTutari" step="0.01" readonly style="background: #f5f5f5;">
                            </div>
                        </div>
                        <div class="alert alert-info">
                            <span class="alert-icon">â„¹ï¸</span>
                            <span>TevkifatlÄ± faturalarda KDV'nin bir kÄ±smÄ± satÄ±cÄ± tarafÄ±ndan beyan edilir.</span>
                        </div>
                    </div>

                    <!-- TaÅŸÄ±t Gideri AyrÄ±mÄ± (%70 Gider / %30 KKEG) -->
                    <div id="tasitGideriAlanlari" style="display: none;">
                        <div class="alert alert-warning">
                            <span class="alert-icon">âš ï¸</span>
                            <div>
                                <strong>TaÅŸÄ±t Gideri AyrÄ±mÄ±:</strong> Bu masraf taÅŸÄ±t gideri olarak iÅŸaretlendi.<br>
                                <small>Tutar otomatik olarak %70 Gider ve %30 KKEG olarak ayrÄ±lacaktÄ±r.</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Gider KÄ±smÄ± (%70)</label>
                                <input type="number" class="form-input" id="giderKismi" step="0.01" readonly style="background: #E8F5E9;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">KKEG KÄ±smÄ± (%30)</label>
                                <input type="number" class="form-input" id="kkegKismi" step="0.01" readonly style="background: #FFF3E0;">
                            </div>
                        </div>
                    </div>

                    <!-- YurtdÄ±ÅŸÄ± Masraf AlanlarÄ± (gizli) -->
                    <div id="yurtdisiAlanlari" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">DÃ¶viz TutarÄ±</label>
                                <input type="number" class="form-input" id="yurtdisiTutar" step="0.01" oninput="convertCurrency()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Para Birimi</label>
                                <select class="form-select" id="paraBirimi">
                                    <option value="USD">USD - Amerikan DolarÄ±</option>
                                    <option value="EUR">EUR - Euro</option>
                                    <option value="GBP">GBP - Ä°ngiliz Sterlini</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Kur OranÄ±</label>
                                <input type="number" class="form-input" id="kurOrani" step="0.0001" oninput="convertCurrency()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">TL KarÅŸÄ±lÄ±ÄŸÄ±</label>
                                <input type="number" class="form-input" id="tlKarsiligi" readonly style="background: #f5f5f5;">
                            </div>
                        </div>
                    </div>

                    <!-- Amount Summary -->
                    <div class="amount-summary">
                        <div class="amount-row">
                            <span>BrÃ¼t Tutar:</span>
                            <span id="summaryBrut">0.00 TL</span>
                        </div>
                        <div class="amount-row">
                            <span>KDV TutarÄ±:</span>
                            <span id="summaryKdv">0.00 TL</span>
                        </div>
                        <div class="amount-row">
                            <span>KDV HariÃ§ Tutar:</span>
                            <span id="summaryNet">0.00 TL</span>
                        </div>
                        <div class="amount-row total">
                            <span>Toplam Masraf:</span>
                            <span id="summaryTotal">0.00 TL</span>
                        </div>
                    </div>
                </div>

                <!-- Section 5: Masraf DetaylarÄ± (Dinamik - Her Belge Ä°Ã§in AyrÄ±) -->
                <div id="masrafDetaylariContainer">
                    <!-- JavaScript ile her belge iÃ§in dinamik olarak oluÅŸturulacak -->
                </div>

                <!-- Section: Onay Bilgileri (Dinamik Numara) -->
                <div class="form-section" id="onayBilgileriSection">
                    <h2 class="section-title">
                        <span class="section-number" id="onayBilgileriSectionNumber">6</span>
                        Onay AkÄ±ÅŸÄ± Bilgileri
                    </h2>

                    <div class="alert alert-info">
                        <span class="alert-icon">â„¹ï¸</span>
                        <div>
                            Masraf tutarÄ±nÄ±za gÃ¶re onay akÄ±ÅŸÄ± otomatik belirlenecektir.
                            <strong>7.500 TL</strong> altÄ± masraflar sadece birim mÃ¼dÃ¼rÃ¼ onayÄ± ile tamamlanÄ±r.
                        </div>
                    </div>

                    <!-- Approval Timeline Preview -->
                    <div class="approval-timeline" id="normalOnayAkisi">
                        <div class="approval-step completed">
                            <div class="step-circle">âœ“</div>
                            <div class="step-label">Talep OluÅŸtur</div>
                            <div class="step-person">Berat TanrÄ±verdi</div>
                        </div>
                        <div class="approval-step current">
                            <div class="step-circle">1</div>
                            <div class="step-label">YÃ¶netici OnayÄ±</div>
                            <div class="step-person">Mehmet YÄ±lmaz (5.Derece)</div>
                        </div>
                        <div class="approval-step">
                            <div class="step-circle">2</div>
                            <div class="step-label">Muhasebe OnayÄ±</div>
                            <div class="step-person">Muhasebe Havuzu</div>
                        </div>
                        <div class="approval-step">
                            <div class="step-circle">3</div>
                            <div class="step-label">SAP AktarÄ±m</div>
                            <div class="step-person">Otomatik</div>
                        </div>
                    </div>

                    <!-- MaÄŸaza MasraflarÄ± iÃ§in ATF Kargo Takip AkÄ±ÅŸÄ± -->
                    <div class="approval-timeline" id="magazaOnayAkisi" style="display: none;">
                        <div class="approval-step completed">
                            <div class="step-circle">âœ“</div>
                            <div class="step-label">Talep OluÅŸtur</div>
                            <div class="step-person">MaÄŸaza Personeli</div>
                        </div>
                        <div class="approval-step current">
                            <div class="step-circle">1</div>
                            <div class="step-label">YÃ¶netici OnayÄ±</div>
                            <div class="step-person">BÃ¶lge MÃ¼dÃ¼rÃ¼</div>
                        </div>
                        <div class="approval-step">
                            <div class="step-circle">2</div>
                            <div class="step-label">Kargo Teslim</div>
                            <div class="step-person">ATF NumarasÄ± Gir</div>
                        </div>
                        <div class="approval-step">
                            <div class="step-circle">3</div>
                            <div class="step-label">Muhasebe OnayÄ±</div>
                            <div class="step-person">Perakende Muhasebe</div>
                        </div>
                        <div class="approval-step">
                            <div class="step-circle">4</div>
                            <div class="step-label">SAP AktarÄ±m</div>
                            <div class="step-person">Otomatik</div>
                        </div>
                    </div>

                    <!-- ATF Kargo Bilgileri (MaÄŸaza masraflarÄ± iÃ§in) -->
                    <div id="atfKargoAlani" style="display: none; margin-top: 20px;">
                        <div class="alert alert-warning">
                            <span class="alert-icon">ğŸ“¦</span>
                            <div>
                                <strong>MaÄŸaza MasrafÄ± - Kargo Takip ZorunluluÄŸu</strong><br>
                                <small>MaÄŸaza masraflarÄ± onaylandÄ±ktan sonra, belgeler kargo ile gÃ¶nderilmeli ve ATF numarasÄ± girilmelidir.
                                Muhasebe onayÄ±, kargo teslim edildiÄŸinde baÅŸlayacaktÄ±r.</small>
                            </div>
                        </div>
                        <div class="form-row" style="margin-top: 16px;">
                            <div class="form-group">
                                <label class="form-label">ATF NumarasÄ± (Kargo Takip)</label>
                                <input type="text" class="form-input" id="atfNumarasi" placeholder="Kargo ÅŸirketi ATF numarasÄ±" disabled>
                                <small style="color: var(--text-secondary); font-size: 11px;">* YÃ¶netici onayÄ±ndan sonra aktif olacaktÄ±r</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Kargo Åirketi</label>
                                <select class="form-select" id="kargoSirketi" disabled>
                                    <option value="">SeÃ§iniz...</option>
                                    <option value="yurtici" selected>YurtiÃ§i Kargo</option>
                                    <option value="aras">Aras Kargo</option>
                                    <option value="mng">MNG Kargo</option>
                                    <option value="ptt">PTT Kargo</option>
                                    <option value="ups">UPS</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Kargo Durumu</label>
                                <div id="kargoDurumu" style="padding: 10px; background: #f5f5f5; border-radius: 6px;">
                                    <span class="status-badge status-draft">Bekleniyor</span>
                                    <span style="font-size: 12px; color: var(--text-secondary); margin-left: 8px;">YÃ¶netici onayÄ± bekleniyor</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tahmini Teslim</label>
                                <input type="date" class="form-input" id="tahminTeslim" disabled>
                            </div>
                        </div>
                    </div>

                    <!-- MaÄŸaza MasrafÄ± Checkbox -->
                    <div style="margin-top: 16px; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="magazaMasrafiCheckbox" onchange="toggleMagazaMasrafi()">
                            <span style="font-size: 14px;">
                                <strong>ğŸª Bu bir maÄŸaza masrafÄ±dÄ±r</strong>
                                <br><small style="color: var(--text-secondary);">MaÄŸaza masraflarÄ± iÃ§in kargo takip sÃ¼reci uygulanÄ±r</small>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="saveDraft()">
                        ğŸ’¾ Taslak Kaydet
                    </button>
                    <button type="button" class="btn-outline" onclick="window.history.back()">
                        Ä°ptal
                    </button>
                    <button type="button" class="btn-primary" onclick="submitMasrafForm()">
                        ğŸ“¤ Onaya GÃ¶nder
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script src="js/main.js"></script>
    <script>
        // ============================================
        // YENÄ° BELGE YÃ–NETÄ°M SÄ°STEMÄ°
        // Her belge kendi gÃ¶rsel kartÄ± ve gider satÄ±rlarÄ±yla birlikte
        // ============================================

        // TÃ¼m yÃ¼klenen belgeler
        let belgeler = [];
        let belgeIdSayaci = 0;
        let satirIdSayaci = 0;

        // Demo belge Ã¶rnekleri
        const demoBelgeOrnekleri = [
            {
                belgeTuru: 'fis',
                firmaAdi: 'MIGROS TÄ°CARET A.Å.',
                firmaTuru: 'Market',
                vergiNo: '9876543210',
                belgeNo: 'MIG-2024-458712',
                belgeTarihi: '2024-12-15',
                ocrGuvenSkoru: 96,
                fisKalemleri: [
                    { urun: '2x KahvaltÄ±lÄ±k Peynir', tutar: 'â‚º89.00' },
                    { urun: '1x Zeytin (500g)', tutar: 'â‚º45.00' },
                    { urun: '6x Yumurta', tutar: 'â‚º36.00' },
                    { urun: '2x SÃ¼t (1L)', tutar: 'â‚º48.00' },
                    { urun: '1x Deterjan (3kg)', tutar: 'â‚º145.00' },
                    { urun: '2x BulaÅŸÄ±k SÃ¼ngeri', tutar: 'â‚º28.00' },
                    { urun: '1x A4 KaÄŸÄ±t (500)', tutar: 'â‚º95.00' },
                    { urun: '3x TÃ¼kenmez Kalem', tutar: 'â‚º24.00' },
                    { urun: 'PoÅŸet Ãœcreti', tutar: 'â‚º2.00' }
                ],
                satirlar: [
                    { kalem: 'GÄ±da', aciklama: 'KahvaltÄ±lÄ±k Peynir (2 adet)', hesapKodu: '770.01', netTutar: 80.91, kdvOrani: 10 },
                    { kalem: 'GÄ±da', aciklama: 'Zeytin 500g', hesapKodu: '770.01', netTutar: 40.91, kdvOrani: 10 },
                    { kalem: 'GÄ±da', aciklama: 'Yumurta (6\'lÄ±)', hesapKodu: '770.01', netTutar: 32.73, kdvOrani: 10 },
                    { kalem: 'GÄ±da', aciklama: 'SÃ¼t 1L (2 adet)', hesapKodu: '770.01', netTutar: 43.64, kdvOrani: 10 },
                    { kalem: 'Temizlik', aciklama: 'Deterjan 3kg', hesapKodu: '770.04', netTutar: 120.83, kdvOrani: 20 },
                    { kalem: 'Temizlik', aciklama: 'BulaÅŸÄ±k SÃ¼ngeri (2 adet)', hesapKodu: '770.04', netTutar: 23.33, kdvOrani: 20 },
                    { kalem: 'KÄ±rtasiye', aciklama: 'A4 KaÄŸÄ±t 500\'lÃ¼', hesapKodu: '770.04', netTutar: 79.17, kdvOrani: 20 },
                    { kalem: 'KÄ±rtasiye', aciklama: 'TÃ¼kenmez Kalem (3 adet)', hesapKodu: '770.04', netTutar: 20.00, kdvOrani: 20 },
                    { kalem: 'DiÄŸer', aciklama: 'PoÅŸet Ãœcreti', hesapKodu: '770.99', netTutar: 1.67, kdvOrani: 20, cikarilabilir: true }
                ]
            },
            {
                belgeTuru: 'fis',
                firmaAdi: 'BÄ°M BÄ°RLEÅÄ°K MAÄAZALAR A.Å.',
                firmaTuru: 'Market',
                vergiNo: '8765432109',
                belgeNo: 'BIM-2024-123456',
                belgeTarihi: '2024-12-14',
                ocrGuvenSkoru: 94,
                fisKalemleri: [
                    { urun: '1x Ã‡ikolata', tutar: 'â‚º35.00' },
                    { urun: '2x Su (1.5L)', tutar: 'â‚º24.00' },
                    { urun: '1x Meyve Suyu', tutar: 'â‚º18.00' },
                    { urun: '1x Ã‡Ã¶p PoÅŸeti', tutar: 'â‚º22.00' },
                    { urun: '1x PeÃ§ete', tutar: 'â‚º15.00' }
                ],
                satirlar: [
                    { kalem: 'GÄ±da', aciklama: 'Ã‡ikolata', hesapKodu: '770.01', netTutar: 31.82, kdvOrani: 10 },
                    { kalem: 'GÄ±da', aciklama: 'Su 1.5L (2 adet)', hesapKodu: '770.01', netTutar: 21.82, kdvOrani: 10 },
                    { kalem: 'GÄ±da', aciklama: 'Meyve Suyu', hesapKodu: '770.01', netTutar: 16.36, kdvOrani: 10 },
                    { kalem: 'Temizlik', aciklama: 'Ã‡Ã¶p PoÅŸeti', hesapKodu: '770.04', netTutar: 18.33, kdvOrani: 20 },
                    { kalem: 'Temizlik', aciklama: 'PeÃ§ete', hesapKodu: '770.04', netTutar: 12.50, kdvOrani: 20 }
                ]
            },
            {
                belgeTuru: 'fis',
                firmaAdi: 'A101 YENÄ° MAÄAZACILIK A.Å.',
                firmaTuru: 'Market',
                vergiNo: '7654321098',
                belgeNo: 'A101-2024-789012',
                belgeTarihi: '2024-12-13',
                ocrGuvenSkoru: 95,
                fisKalemleri: [
                    { urun: '2x Ã‡ay (500g)', tutar: 'â‚º86.00' },
                    { urun: '1x Kahve (250g)', tutar: 'â‚º65.00' },
                    { urun: '1x Defter (3\'lÃ¼)', tutar: 'â‚º45.00' },
                    { urun: '5x KurÅŸun Kalem', tutar: 'â‚º30.00' },
                    { urun: '1x BiskÃ¼vi', tutar: 'â‚º28.00' },
                    { urun: '1x Åeker (1kg)', tutar: 'â‚º35.00' }
                ],
                satirlar: [
                    { kalem: 'GÄ±da', aciklama: 'Ã‡ay 500g (2 adet)', hesapKodu: '770.01', netTutar: 78.18, kdvOrani: 10 },
                    { kalem: 'GÄ±da', aciklama: 'Kahve 250g', hesapKodu: '770.01', netTutar: 59.09, kdvOrani: 10 },
                    { kalem: 'KÄ±rtasiye', aciklama: 'Defter 3\'lÃ¼', hesapKodu: '770.04', netTutar: 37.50, kdvOrani: 20 },
                    { kalem: 'KÄ±rtasiye', aciklama: 'KurÅŸun Kalem (5 adet)', hesapKodu: '770.04', netTutar: 25.00, kdvOrani: 20 },
                    { kalem: 'GÄ±da', aciklama: 'BiskÃ¼vi', hesapKodu: '770.01', netTutar: 25.45, kdvOrani: 10 },
                    { kalem: 'GÄ±da', aciklama: 'Åeker 1kg', hesapKodu: '770.01', netTutar: 31.82, kdvOrani: 10 }
                ]
            }
        ];

        let demoFisIndex = 0;
        let demoFaturaIndex = 0;

        // Fatura Ã¶rnekleri (Cari bilgisi ile)
        const demoFaturaOrnekleri = [
            {
                belgeTuru: 'fatura',
                firmaAdi: 'TURKCELL Ä°LETÄ°ÅÄ°M HÄ°ZMETLERÄ° A.Å.',
                firmaTuru: 'TelekomÃ¼nikasyon',
                vergiNo: '4860020949',
                belgeNo: 'FTR-2024-0085421',
                belgeTarihi: '2024-12-10',
                ocrGuvenSkoru: 98,
                cariDurumu: 'mevcut',
                cariKodu: '320.01.045',
                fisKalemleri: [
                    { urun: 'Kurumsal Hat Ãœcreti', tutar: 'â‚º450.00' },
                    { urun: 'Data Paketi (50GB)', tutar: 'â‚º180.00' },
                    { urun: 'UluslararasÄ± GÃ¶rÃ¼ÅŸme', tutar: 'â‚º85.00' },
                    { urun: 'KDV (%20)', tutar: 'â‚º143.00' }
                ],
                satirlar: [
                    { kalem: 'TelekomÃ¼nikasyon', aciklama: 'Kurumsal Hat Ãœcreti', hesapKodu: '770.05', netTutar: 375.00, kdvOrani: 20 },
                    { kalem: 'TelekomÃ¼nikasyon', aciklama: 'Data Paketi 50GB', hesapKodu: '770.05', netTutar: 150.00, kdvOrani: 20 },
                    { kalem: 'TelekomÃ¼nikasyon', aciklama: 'UluslararasÄ± GÃ¶rÃ¼ÅŸme', hesapKodu: '770.05', netTutar: 70.83, kdvOrani: 20 }
                ]
            },
            {
                belgeTuru: 'fatura',
                firmaAdi: 'SHELL TÃœRKÄ°YE A.Å.',
                firmaTuru: 'AkaryakÄ±t',
                vergiNo: '7890123456',
                belgeNo: 'FTR-2024-9845632',
                belgeTarihi: '2024-12-12',
                ocrGuvenSkoru: 97,
                cariDurumu: 'mevcut',
                cariKodu: '320.01.089',
                fisKalemleri: [
                    { urun: 'Motorin (45 Lt)', tutar: 'â‚º1,845.00' },
                    { urun: 'Motor YaÄŸÄ± (4 Lt)', tutar: 'â‚º650.00' },
                    { urun: 'KDV (%20)', tutar: 'â‚º499.00' }
                ],
                satirlar: [
                    { kalem: 'AkaryakÄ±t', aciklama: 'Motorin 45 Litre', hesapKodu: '770.07', netTutar: 1537.50, kdvOrani: 20 },
                    { kalem: 'BakÄ±m', aciklama: 'Motor YaÄŸÄ± 4 Litre', hesapKodu: '770.07', netTutar: 541.67, kdvOrani: 20 }
                ]
            },
            {
                belgeTuru: 'fatura',
                firmaAdi: 'YENÄ° TEDARÄ°KÃ‡Ä° LTD. ÅTÄ°.',
                firmaTuru: 'Ofis Malzemeleri',
                vergiNo: '1234509876',
                belgeNo: 'FTR-2024-0001234',
                belgeTarihi: '2024-12-14',
                ocrGuvenSkoru: 95,
                cariDurumu: 'gerekli', // Cari kaydÄ± yok
                cariKodu: null,
                fisKalemleri: [
                    { urun: 'Ofis KoltuÄŸu (2 adet)', tutar: 'â‚º4,500.00' },
                    { urun: 'Masa LambasÄ± (3 adet)', tutar: 'â‚º750.00' },
                    { urun: 'KDV (%20)', tutar: 'â‚º1,050.00' }
                ],
                satirlar: [
                    { kalem: 'DemirbaÅŸ', aciklama: 'Ofis KoltuÄŸu (2 adet)', hesapKodu: '255.01', netTutar: 3750.00, kdvOrani: 20 },
                    { kalem: 'DemirbaÅŸ', aciklama: 'Masa LambasÄ± (3 adet)', hesapKodu: '255.01', netTutar: 625.00, kdvOrani: 20 }
                ]
            }
        ];

        // ============================================
        // BELGE KARTI RENDER FONKSÄ°YONLARI
        // ============================================

        // Belge tÃ¼rÃ¼ seÃ§imi deÄŸiÅŸtiÄŸinde
        function belgeTuruDegisti() {
            const fisLabel = document.getElementById('belgeTuruFisLabel');
            const faturaLabel = document.getElementById('belgeTuruFaturaLabel');
            const seciliTur = document.querySelector('input[name="yeniBelgeTuru"]:checked').value;

            if (seciliTur === 'fis') {
                fisLabel.style.borderColor = 'var(--primary-orange)';
                fisLabel.style.background = '#fff3e0';
                faturaLabel.style.borderColor = '#e0e0e0';
                faturaLabel.style.background = 'white';
            } else {
                faturaLabel.style.borderColor = 'var(--primary-orange)';
                faturaLabel.style.background = '#fff3e0';
                fisLabel.style.borderColor = '#e0e0e0';
                fisLabel.style.background = 'white';
            }
        }

        // Demo fiÅŸ ekle
        function demoFisEkle() {
            const ornek = demoBelgeOrnekleri[demoFisIndex];
            demoFisIndex = (demoFisIndex + 1) % demoBelgeOrnekleri.length;
            belgeEkle(ornek);
        }

        // Demo fatura ekle
        function demoFaturaEkle() {
            const ornek = demoFaturaOrnekleri[demoFaturaIndex];
            demoFaturaIndex = (demoFaturaIndex + 1) % demoFaturaOrnekleri.length;
            belgeEkle(ornek);
        }

        // Belge ekle (ortak fonksiyon)
        function belgeEkle(ornek) {
            belgeIdSayaci++;
            const yeniBelge = {
                id: belgeIdSayaci,
                ...ornek,
                satirlar: ornek.satirlar.map(satir => {
                    satirIdSayaci++;
                    return {
                        id: satirIdSayaci,
                        belgeId: belgeIdSayaci,
                        aktif: true,
                        ...satir
                    };
                })
            };

            belgeler.push(yeniBelge);
            renderBelgeler();
            guncelleToplamOzet();
            guncelleBelgeBilgileri();
            guncelleMasrafDetaylari();

            const cariMesaj = ornek.belgeTuru === 'fatura'
                ? (ornek.cariDurumu === 'mevcut' ? ' (Cari Mevcut)' : ' (âš ï¸ Cari Gerekli)')
                : '';
            showAlert('success', `ğŸ“„ ${ornek.firmaAdi} ${ornek.belgeTuru === 'fis' ? 'fiÅŸi' : 'faturasÄ±'} eklendi!${cariMesaj}`);
        }

        // Eski demo fonksiyonu (geriye uyumluluk)
        function demoBelgeEkle() {
            const ornek = demoBelgeOrnekleri[demoOrnekIndex];
            demoOrnekIndex = (demoOrnekIndex + 1) % demoBelgeOrnekleri.length;

            belgeIdSayaci++;
            const yeniBelge = {
                id: belgeIdSayaci,
                ...ornek,
                satirlar: ornek.satirlar.map(satir => {
                    satirIdSayaci++;
                    return {
                        id: satirIdSayaci,
                        belgeId: belgeIdSayaci,
                        aktif: true,
                        ...satir
                    };
                })
            };

            belgeler.push(yeniBelge);
            renderBelgeler();
            guncelleToplamOzet();
            guncelleBelgeBilgileri();
            guncelleMasrafDetaylari();

            showAlert('success', `ğŸ“„ ${ornek.firmaAdi} belgesi eklendi! ${ornek.satirlar.length} gider satÄ±rÄ± okundu.`);
        }

        // TÃ¼m belgeleri render et
        function renderBelgeler() {
            const container = document.getElementById('belgelerContainer');
            container.innerHTML = '';

            if (belgeler.length === 0) {
                document.getElementById('toplamOzetAlani').style.display = 'none';
                return;
            }

            document.getElementById('toplamOzetAlani').style.display = 'block';

            belgeler.forEach((belge, index) => {
                const belgeKarti = document.createElement('div');
                belgeKarti.className = 'belge-karti-wrapper';
                belgeKarti.id = `belge-${belge.id}`;
                belgeKarti.style.cssText = 'margin-bottom: 24px; border: 2px solid #e0e0e0; border-radius: 12px; overflow: hidden; background: white;';

                // Belge toplamlarÄ±nÄ± hesapla
                const aktifSatirlar = belge.satirlar.filter(s => s.aktif);
                const belgeToplam = aktifSatirlar.reduce((acc, s) => {
                    const kdv = s.netTutar * s.kdvOrani / 100;
                    return { net: acc.net + s.netTutar, kdv: acc.kdv + kdv, brut: acc.brut + s.netTutar + kdv };
                }, { net: 0, kdv: 0, brut: 0 });

                // Cari durumu HTML'i (sadece fatura iÃ§in)
                const cariDurumuHtml = belge.belgeTuru === 'fatura' ? `
                    <div style="margin-top: 8px; padding: 8px 12px; background: ${belge.cariDurumu === 'mevcut' ? 'rgba(76, 175, 80, 0.2)' : 'rgba(255, 152, 0, 0.3)'}; border-radius: 6px;">
                        ${belge.cariDurumu === 'mevcut'
                            ? `<span style="font-size: 12px;">âœ… Cari Mevcut: <strong>${belge.cariKodu}</strong></span>`
                            : `<span style="font-size: 12px;">âš ï¸ Cari Gerekli - TedarikÃ§i SAP'da tanÄ±mlÄ± deÄŸil</span>`
                        }
                    </div>
                ` : '';

                // Belge tÃ¼rÃ¼ etiketi
                const belgeTuruEtiket = belge.belgeTuru === 'fatura'
                    ? '<span style="background: #2196F3; padding: 2px 8px; border-radius: 4px; font-size: 10px; margin-left: 8px;">FATURA</span>'
                    : '<span style="background: #4CAF50; padding: 2px 8px; border-radius: 4px; font-size: 10px; margin-left: 8px;">FÄ°Å</span>';

                belgeKarti.innerHTML = `
                    <!-- Belge BaÅŸlÄ±ÄŸÄ± -->
                    <div style="background: linear-gradient(135deg, ${belge.belgeTuru === 'fatura' ? '#1976D2' : 'var(--primary-orange)'} 0%, ${belge.belgeTuru === 'fatura' ? '#0d47a1' : '#e65100'} 100%); color: white; padding: 16px 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <div style="font-size: 11px; opacity: 0.9; margin-bottom: 4px;">BELGE ${index + 1} ${belgeTuruEtiket}</div>
                                <div style="font-size: 18px; font-weight: 700;">${belge.firmaAdi}</div>
                                <div style="font-size: 12px; opacity: 0.9;">${belge.belgeNo} â€¢ ${formatTarih(belge.belgeTarihi)} â€¢ VKN: ${belge.vergiNo}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 20px; font-size: 12px; margin-bottom: 8px;">
                                    ğŸ¤– OCR %${belge.ocrGuvenSkoru}
                                </div>
                                <button onclick="belgeSil(${belge.id})" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px;">
                                    ğŸ—‘ï¸ Belgeyi KaldÄ±r
                                </button>
                            </div>
                        </div>
                        ${cariDurumuHtml}
                    </div>

                    <!-- Belge Ä°Ã§eriÄŸi: Sol tarafta fiÅŸ gÃ¶rseli, saÄŸda gider satÄ±rlarÄ± -->
                    <div style="display: grid; grid-template-columns: 280px 1fr; gap: 0;">
                        <!-- Sol: FiÅŸ GÃ¶rseli -->
                        <div style="background: #f5f5f5; padding: 20px; border-right: 1px solid #e0e0e0;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
                                ğŸ–¼ï¸ Belge GÃ¶rseli (OCR ile Okundu)
                            </div>
                            <div class="receipt-simple" style="background: white; padding: 16px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 11px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="text-align: center; border-bottom: 1px dashed #ccc; padding-bottom: 8px; margin-bottom: 8px;">
                                    <strong style="font-size: 12px;">${belge.firmaAdi}</strong><br>
                                    <span style="font-size: 10px; color: #666;">${belge.firmaTuru || 'Ticaret'}</span>
                                </div>
                                <div style="font-size: 10px; color: #666; margin-bottom: 8px;">
                                    VKN: ${belge.vergiNo}<br>
                                    Tarih: ${formatTarih(belge.belgeTarihi)}<br>
                                    FiÅŸ No: ${belge.belgeNo}
                                </div>
                                <div style="border-top: 1px dashed #ccc; border-bottom: 1px dashed #ccc; padding: 8px 0; margin: 8px 0;">
                                    ${belge.fisKalemleri.map(k => `
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                            <span style="flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${k.urun}</span>
                                            <span style="margin-left: 8px; font-weight: 600;">${k.tutar}</span>
                                        </div>
                                    `).join('')}
                                </div>
                                <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 13px; color: var(--primary-orange);">
                                    <span>TOPLAM</span>
                                    <span>â‚º${belgeToplam.brut.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>

                        <!-- SaÄŸ: Gider SatÄ±rlarÄ± -->
                        <div style="padding: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <div style="font-size: 14px; font-weight: 600; color: #333;">
                                    ğŸ“Š Okunan Gider Kalemleri <span style="color: #666; font-weight: 400;">(${aktifSatirlar.length} satÄ±r)</span>
                                </div>
                                <div style="font-size: 12px; color: #666;">
                                    Masraf harici satÄ±rlarÄ± Ã§Ä±karabilirsiniz
                                </div>
                            </div>

                            <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                                <thead>
                                    <tr style="background: #f8f9fa;">
                                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #e0e0e0;">Kalem</th>
                                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #e0e0e0;">AÃ§Ä±klama</th>
                                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #e0e0e0;">Hesap</th>
                                        <th style="padding: 8px; text-align: right; border-bottom: 2px solid #e0e0e0;">Net</th>
                                        <th style="padding: 8px; text-align: center; border-bottom: 2px solid #e0e0e0;">KDV</th>
                                        <th style="padding: 8px; text-align: right; border-bottom: 2px solid #e0e0e0;">BrÃ¼t</th>
                                        <th style="padding: 8px; text-align: center; border-bottom: 2px solid #e0e0e0; width: 40px;"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${belge.satirlar.map(satir => {
                                        const kdvTutar = satir.netTutar * satir.kdvOrani / 100;
                                        const brutTutar = satir.netTutar + kdvTutar;
                                        const opacity = satir.aktif ? '1' : '0.4';
                                        const textDecoration = satir.aktif ? 'none' : 'line-through';
                                        return `
                                            <tr style="opacity: ${opacity}; text-decoration: ${textDecoration};" id="satir-${satir.id}">
                                                <td style="padding: 8px; border-bottom: 1px solid #eee;">
                                                    <span style="background: ${getKalemRenk(satir.kalem)}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px;">
                                                        ${satir.kalem}
                                                    </span>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #eee;">${satir.aciklama}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #eee;">
                                                    <code style="background: #f0f0f0; padding: 2px 6px; border-radius: 3px; font-size: 10px;">${satir.hesapKodu}</code>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">â‚º${satir.netTutar.toFixed(2)}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;">
                                                    <span style="background: ${getKdvRenk(satir.kdvOrani)}; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px;">
                                                        %${satir.kdvOrani}
                                                    </span>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right; font-weight: 600;">â‚º${brutTutar.toFixed(2)}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;">
                                                    ${satir.aktif ? `
                                                        <button onclick="satirCikar(${belge.id}, ${satir.id})" style="background: none; border: none; color: #f44336; cursor: pointer; font-size: 14px;" title="Bu satÄ±rÄ± Ã§Ä±kar">
                                                            âœ•
                                                        </button>
                                                    ` : `
                                                        <button onclick="satirGeriAl(${belge.id}, ${satir.id})" style="background: none; border: none; color: #4CAF50; cursor: pointer; font-size: 14px;" title="Bu satÄ±rÄ± geri al">
                                                            â†©ï¸
                                                        </button>
                                                    `}
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                                <tfoot>
                                    <tr style="background: #fff3e0; font-weight: 600;">
                                        <td colspan="3" style="padding: 10px; text-align: right;">BELGE TOPLAMI:</td>
                                        <td style="padding: 10px; text-align: right;">â‚º${belgeToplam.net.toFixed(2)}</td>
                                        <td style="padding: 10px; text-align: center; color: #2196F3;">â‚º${belgeToplam.kdv.toFixed(2)}</td>
                                        <td style="padding: 10px; text-align: right; color: var(--primary-orange);">â‚º${belgeToplam.brut.toFixed(2)}</td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                `;

                container.appendChild(belgeKarti);
            });
        }

        // Tarih formatla
        function formatTarih(tarihStr) {
            const tarih = new Date(tarihStr);
            return tarih.toLocaleDateString('tr-TR');
        }

        // SatÄ±rÄ± Ã§Ä±kar (pasif yap)
        function satirCikar(belgeId, satirId) {
            const belge = belgeler.find(b => b.id === belgeId);
            if (belge) {
                const satir = belge.satirlar.find(s => s.id === satirId);
                if (satir) {
                    satir.aktif = false;
                    renderBelgeler();
                    guncelleToplamOzet();
                    guncelleBelgeBilgileri();
                    showAlert('info', `"${satir.aciklama}" satÄ±rÄ± Ã§Ä±karÄ±ldÄ±.`);
                }
            }
        }

        // SatÄ±rÄ± geri al
        function satirGeriAl(belgeId, satirId) {
            const belge = belgeler.find(b => b.id === belgeId);
            if (belge) {
                const satir = belge.satirlar.find(s => s.id === satirId);
                if (satir) {
                    satir.aktif = true;
                    renderBelgeler();
                    guncelleToplamOzet();
                    guncelleBelgeBilgileri();
                    showAlert('success', `"${satir.aciklama}" satÄ±rÄ± geri alÄ±ndÄ±.`);
                }
            }
        }

        // Belgeyi sil
        function belgeSil(belgeId) {
            const belge = belgeler.find(b => b.id === belgeId);
            if (belge && confirm(`"${belge.firmaAdi}" belgesini ve tÃ¼m gider satÄ±rlarÄ±nÄ± silmek istediÄŸinize emin misiniz?`)) {
                belgeler = belgeler.filter(b => b.id !== belgeId);
                renderBelgeler();
                guncelleToplamOzet();
                guncelleBelgeBilgileri();
                guncelleMasrafDetaylari();
                showAlert('info', `"${belge.firmaAdi}" belgesi kaldÄ±rÄ±ldÄ±.`);
            }
        }

        // Toplam Ã¶zeti gÃ¼ncelle
        function guncelleToplamOzet() {
            let toplamBelge = belgeler.length;
            let toplamSatir = 0;
            let toplamNet = 0;
            let toplamKdv = 0;
            let toplamBrut = 0;
            const kdvDagilimi = {};

            belgeler.forEach(belge => {
                belge.satirlar.filter(s => s.aktif).forEach(satir => {
                    toplamSatir++;
                    const kdv = satir.netTutar * satir.kdvOrani / 100;
                    toplamNet += satir.netTutar;
                    toplamKdv += kdv;
                    toplamBrut += satir.netTutar + kdv;

                    // KDV daÄŸÄ±lÄ±mÄ±
                    if (!kdvDagilimi[satir.kdvOrani]) {
                        kdvDagilimi[satir.kdvOrani] = { net: 0, kdv: 0 };
                    }
                    kdvDagilimi[satir.kdvOrani].net += satir.netTutar;
                    kdvDagilimi[satir.kdvOrani].kdv += kdv;
                });
            });

            document.getElementById('toplamBelgeSayisi').textContent = toplamBelge;
            document.getElementById('toplamSatirSayisi').textContent = toplamSatir;
            document.getElementById('toplamNetTutarOzet').textContent = 'â‚º' + toplamNet.toFixed(2);
            document.getElementById('toplamKdvTutarOzet').textContent = 'â‚º' + toplamKdv.toFixed(2);
            document.getElementById('toplamBrutTutarOzet').textContent = 'â‚º' + toplamBrut.toFixed(2);

            // KDV daÄŸÄ±lÄ±mÄ± render
            const kdvContainer = document.getElementById('kdvDagilimiOzet');
            kdvContainer.innerHTML = Object.keys(kdvDagilimi).sort((a, b) => a - b).map(oran => `
                <div style="background: white; padding: 8px 12px; border-radius: 6px; border: 1px solid #e0e0e0;">
                    <span style="background: ${getKdvRenk(parseInt(oran))}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-right: 8px;">
                        %${oran}
                    </span>
                    <span style="font-weight: 600;">â‚º${kdvDagilimi[oran].kdv.toFixed(2)}</span>
                    <span style="color: #666; font-size: 11px;"> (Matrah: â‚º${kdvDagilimi[oran].net.toFixed(2)})</span>
                </div>
            `).join('');

            // Ana form alanlarÄ±nÄ± da gÃ¼ncelle
            if (document.getElementById('brutTutar')) {
                document.getElementById('brutTutar').value = toplamBrut.toFixed(2);
            }
            if (document.getElementById('netTutar')) {
                document.getElementById('netTutar').value = toplamNet.toFixed(2);
            }
            if (document.getElementById('kdvTutari')) {
                document.getElementById('kdvTutari').value = toplamKdv.toFixed(2);
            }
        }

        // Belge Bilgileri bÃ¶lÃ¼mÃ¼nÃ¼ gÃ¼ncelle (gruplu gÃ¶rÃ¼nÃ¼m)
        function guncelleBelgeBilgileri() {
            const section = document.getElementById('belgeBilgileriSection');
            const listesi = document.getElementById('belgeBilgileriListesi');
            const badge = document.getElementById('belgeBilgileriBadge');

            if (belgeler.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            badge.textContent = `${belgeler.length} Belge`;

            // FiÅŸ ve Fatura sayÄ±larÄ±nÄ± hesapla
            const fisSayisi = belgeler.filter(b => b.belgeTuru === 'fis').length;
            const faturaSayisi = belgeler.filter(b => b.belgeTuru === 'fatura').length;
            const cariGerekliSayisi = belgeler.filter(b => b.belgeTuru === 'fatura' && b.cariDurumu === 'gerekli').length;

            let html = `
                <!-- Ã–zet Bar -->
                <div style="display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap;">
                    <div style="background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; padding: 12px 20px; border-radius: 8px; flex: 1; min-width: 150px;">
                        <div style="font-size: 11px; opacity: 0.9;">ğŸ§¾ FiÅŸ SayÄ±sÄ±</div>
                        <div style="font-size: 24px; font-weight: 700;">${fisSayisi}</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #2196F3, #1565C0); color: white; padding: 12px 20px; border-radius: 8px; flex: 1; min-width: 150px;">
                        <div style="font-size: 11px; opacity: 0.9;">ğŸ“„ Fatura SayÄ±sÄ±</div>
                        <div style="font-size: 24px; font-weight: 700;">${faturaSayisi}</div>
                    </div>
                    ${cariGerekliSayisi > 0 ? `
                        <div style="background: linear-gradient(135deg, #FF9800, #E65100); color: white; padding: 12px 20px; border-radius: 8px; flex: 1; min-width: 150px;">
                            <div style="font-size: 11px; opacity: 0.9;">âš ï¸ Cari Gerekli</div>
                            <div style="font-size: 24px; font-weight: 700;">${cariGerekliSayisi}</div>
                        </div>
                    ` : ''}
                </div>

                <!-- Belge Listesi -->
                <div style="display: grid; gap: 12px;">
            `;

            belgeler.forEach((belge, index) => {
                const aktifSatirSayisi = belge.satirlar.filter(s => s.aktif).length;
                const toplamSatirSayisi = belge.satirlar.length;
                const belgeToplam = belge.satirlar.filter(s => s.aktif).reduce((acc, s) => acc + s.netTutar + (s.netTutar * s.kdvOrani / 100), 0);

                const belgeTuruRenk = belge.belgeTuru === 'fatura' ? '#2196F3' : '#4CAF50';
                const belgeTuruIcon = belge.belgeTuru === 'fatura' ? 'ğŸ“„' : 'ğŸ§¾';
                const belgeTuruAdi = belge.belgeTuru === 'fatura' ? 'FATURA' : 'FÄ°Å';

                // Cari durumu (sadece fatura iÃ§in)
                let cariHtml = '';
                if (belge.belgeTuru === 'fatura') {
                    if (belge.cariDurumu === 'mevcut') {
                        cariHtml = `<span style="background: #E8F5E9; color: #2E7D32; padding: 4px 10px; border-radius: 12px; font-size: 11px;">âœ… ${belge.cariKodu}</span>`;
                    } else {
                        cariHtml = `<span style="background: #FFF3E0; color: #E65100; padding: 4px 10px; border-radius: 12px; font-size: 11px;">âš ï¸ Cari Gerekli</span>`;
                    }
                }

                html += `
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 10px; padding: 16px; border-left: 4px solid ${belgeTuruRenk};">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 12px;">
                            <div style="flex: 2; min-width: 250px;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <span style="font-size: 18px;">${belgeTuruIcon}</span>
                                    <span style="background: ${belgeTuruRenk}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px;">${belgeTuruAdi}</span>
                                    <span style="font-weight: 700; font-size: 15px;">${belge.firmaAdi}</span>
                                    ${cariHtml}
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 8px; font-size: 13px; color: #555;">
                                    <div><span style="color: #999;">Belge No:</span> <strong>${belge.belgeNo}</strong></div>
                                    <div><span style="color: #999;">Tarih:</span> <strong>${formatTarih(belge.belgeTarihi)}</strong></div>
                                    <div><span style="color: #999;">VKN:</span> <strong>${belge.vergiNo}</strong></div>
                                    <div><span style="color: #999;">SatÄ±r:</span> <strong>${aktifSatirSayisi}/${toplamSatirSayisi}</strong></div>
                                </div>
                            </div>
                            <div style="text-align: right; min-width: 120px;">
                                <div style="font-size: 11px; color: #666;">Belge TutarÄ±</div>
                                <div style="font-size: 20px; font-weight: 700; color: ${belgeTuruRenk};">â‚º${belgeToplam.toFixed(2)}</div>
                                <div style="font-size: 11px; color: #999; margin-top: 4px;">OCR %${belge.ocrGuvenSkoru}</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += `</div>`;
            listesi.innerHTML = html;
        }

        // ============================================
        // MASRAF DETAYLARI DÄ°NAMÄ°K OLUÅTURMA
        // Her belge iÃ§in ayrÄ± Masraf DetaylarÄ± bÃ¶lÃ¼mÃ¼
        // ============================================
        function guncelleMasrafDetaylari() {
            const container = document.getElementById('masrafDetaylariContainer');
            const onayBilgileriNumara = document.getElementById('onayBilgileriSectionNumber');

            if (belgeler.length === 0) {
                container.innerHTML = '';
                // Belge yokken Onay AkÄ±ÅŸÄ± section numarasÄ± 5 olsun
                if (onayBilgileriNumara) {
                    onayBilgileriNumara.textContent = '5';
                }
                return;
            }

            let html = '';

            belgeler.forEach((belge, index) => {
                const belgeTuruRenk = belge.belgeTuru === 'fatura' ? '#2196F3' : '#4CAF50';
                const belgeTuruIcon = belge.belgeTuru === 'fatura' ? 'ğŸ“„' : 'ğŸ§¾';
                const belgeTuruAdi = belge.belgeTuru === 'fatura' ? 'FATURA' : 'FÄ°Å';
                const sectionNumber = 5 + index;

                // Belge toplam tutarÄ±nÄ± hesapla
                const aktifSatirlar = belge.satirlar.filter(s => s.aktif);
                const belgeToplam = aktifSatirlar.reduce((acc, s) => {
                    const kdv = s.netTutar * s.kdvOrani / 100;
                    return acc + s.netTutar + kdv;
                }, 0);

                html += `
                <div class="form-section" id="masrafDetay-${belge.id}" style="border-left: 4px solid ${belgeTuruRenk};">
                    <h2 class="section-title" style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span class="section-number">${sectionNumber}</span>
                            Masraf DetaylarÄ±
                            <span style="background: ${belgeTuruRenk}; color: white; padding: 4px 12px; border-radius: 16px; font-size: 12px; font-weight: 500;">
                                ${belgeTuruIcon} ${belge.firmaAdi}
                            </span>
                        </div>
                        <div style="font-size: 14px; color: ${belgeTuruRenk}; font-weight: 600;">
                            â‚º${belgeToplam.toFixed(2)}
                        </div>
                    </h2>

                    <!-- Belge Ã–zet Bilgisi -->
                    <div style="background: linear-gradient(135deg, ${belgeTuruRenk}15, ${belgeTuruRenk}08); border: 1px solid ${belgeTuruRenk}30; border-radius: 8px; padding: 12px 16px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
                            <div style="display: flex; gap: 16px; flex-wrap: wrap; font-size: 13px;">
                                <span><strong>Belge No:</strong> ${belge.belgeNo}</span>
                                <span><strong>Tarih:</strong> ${formatTarih(belge.belgeTarihi)}</span>
                                <span><strong>VKN:</strong> ${belge.vergiNo}</span>
                            </div>
                            <span style="background: ${belgeTuruRenk}; color: white; padding: 2px 10px; border-radius: 12px; font-size: 11px;">${belgeTuruAdi}</span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Masraf Merkezi</label>
                            <input type="text" class="form-input masraf-merkezi" data-belge-id="${belge.id}" value="50G1022 - Dijital ÃœrÃ¼nler" readonly style="background: #f5f5f5;">
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Masraf TÃ¼rÃ¼ / Hesap Kodu</label>
                            <select class="form-select hesap-kodu" data-belge-id="${belge.id}" onchange="masrafDetayDegisti(${belge.id})">
                                <option value="">SeÃ§iniz...</option>
                                <optgroup label="Genel YÃ¶netim Giderleri - Merkez (770)">
                                    <option value="770.01">770.01 - Yemek Giderleri</option>
                                    <option value="770.02">770.02 - UlaÅŸÄ±m Giderleri</option>
                                    <option value="770.03">770.03 - Konaklama Giderleri</option>
                                    <option value="770.04">770.04 - Ofis Malzemesi</option>
                                    <option value="770.05">770.05 - Temsil AÄŸÄ±rlama</option>
                                    <option value="770.06">770.06 - HaberleÅŸme Giderleri</option>
                                    <option value="770.07">770.07 - TaÅŸÄ±t Giderleri</option>
                                </optgroup>
                                <optgroup label="Pazarlama SatÄ±ÅŸ DaÄŸÄ±tÄ±m - MaÄŸazalar (760)">
                                    <option value="760.01">760.01 - MaÄŸaza Giderleri</option>
                                    <option value="760.02">760.02 - TanÄ±tÄ±m Giderleri</option>
                                    <option value="760.03">760.03 - SatÄ±ÅŸ Promosyon</option>
                                </optgroup>
                                <optgroup label="Ar-Ge / TasarÄ±m Merkezi (750)">
                                    <option value="750.01">750.01 - Proje Giderleri</option>
                                    <option value="750.02">750.02 - AraÅŸtÄ±rma Giderleri</option>
                                    <option value="750.03">750.03 - Test ve GeliÅŸtirme</option>
                                </optgroup>
                                <optgroup label="Teknoloji Teknik Destek (740)">
                                    <option value="740.01">740.01 - YazÄ±lÄ±m Giderleri</option>
                                    <option value="740.02">740.02 - DonanÄ±m BakÄ±m</option>
                                    <option value="740.03">740.03 - IT Destek Hizmetleri</option>
                                </optgroup>
                                <optgroup label="Fabrika Giderleri (730)">
                                    <option value="730.01">730.01 - Ãœretim Giderleri</option>
                                    <option value="730.02">730.02 - Hammadde Giderleri</option>
                                    <option value="730.03">730.03 - BakÄ±m OnarÄ±m</option>
                                </optgroup>
                                <optgroup label="ÅirketlerarasÄ± YansÄ±tmalar (198)">
                                    <option value="198.01">198.01 - FLO MaÄŸazacÄ±lÄ±k YansÄ±tma</option>
                                    <option value="198.02">198.02 - FLO Teknoloji YansÄ±tma</option>
                                    <option value="198.03">198.03 - Turuncu YansÄ±tma</option>
                                </optgroup>
                                <optgroup label="Kiralama Giderleri (632)">
                                    <option value="632.04.01">632.04.01 - MaÄŸaza Asgari Kira</option>
                                    <option value="632.04.02">632.04.02 - Ortak YÃ¶netim Gideri</option>
                                    <option value="632.04.03">632.04.03 - Ciro Kira Gideri</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Proje Kodu (Opsiyonel)</label>
                            <select class="form-select proje-kodu" data-belge-id="${belge.id}" onchange="masrafDetayDegisti(${belge.id})">
                                <option value="">Proje seÃ§iniz (opsiyonel)...</option>
                                <option value="PRJ001">PRJ001 - E-Ticaret Yenileme</option>
                                <option value="PRJ002">PRJ002 - Mobil Uygulama v2</option>
                                <option value="PRJ003">PRJ003 - CRM Entegrasyonu</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Åirket</label>
                            <select class="form-select sirket" data-belge-id="${belge.id}" onchange="masrafDetayDegisti(${belge.id})">
                                <option value="flo_magazacilik">FLO MaÄŸazacÄ±lÄ±k</option>
                                <option value="turuncu">Turuncu AyakkabÄ±</option>
                                <option value="flo_teknoloji">FLO Teknoloji</option>
                                <option value="flo_ic_dis">FLO Ä°Ã§ DÄ±ÅŸ Ticaret</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label class="form-label required">Masraf AÃ§Ä±klamasÄ±</label>
                            <textarea class="form-textarea aciklama" data-belge-id="${belge.id}" placeholder="Bu belge iÃ§in masrafÄ±n ne amaÃ§la yapÄ±ldÄ±ÄŸÄ±nÄ± detaylÄ± aÃ§Ä±klayÄ±nÄ±z..." required oninput="aiHesapOnerisiBelge(this.value, ${belge.id})"></textarea>
                            <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                                * Bu aÃ§Ä±klama hesap eÅŸleÅŸtirmesinde kullanÄ±lacaktÄ±r. LÃ¼tfen detaylÄ± yazÄ±nÄ±z.
                            </small>
                            <!-- AI Hesap Ã–nerisi -->
                            <div id="aiHesapOneriContainer-${belge.id}" style="display: none; margin-top: 8px; padding: 10px 14px; background: linear-gradient(135deg, #E3F2FD, #BBDEFB); border-radius: 8px; border-left: 4px solid #2196F3;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 18px;">ğŸ¤–</span>
                                    <div>
                                        <div style="font-size: 11px; color: #1565C0; font-weight: 600;">AI Hesap Ã–nerisi</div>
                                        <div id="aiHesapOneriText-${belge.id}" style="font-size: 13px; color: #0D47A1; font-weight: 500;"></div>
                                    </div>
                                    <button type="button" onclick="aiOneriUygulaBelge(${belge.id})" style="margin-left: auto; background: #2196F3; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 11px; cursor: pointer; font-weight: 600;">
                                        Uygula
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            });

            container.innerHTML = html;

            // Onay AkÄ±ÅŸÄ± bÃ¶lÃ¼m numarasÄ±nÄ± gÃ¼ncelle (5 + belge sayÄ±sÄ±)
            if (onayBilgileriNumara) {
                onayBilgileriNumara.textContent = 5 + belgeler.length;
            }
        }

        // Belge bazlÄ± masraf detayÄ± deÄŸiÅŸikliÄŸi
        function masrafDetayDegisti(belgeId) {
            const belge = belgeler.find(b => b.id === belgeId);
            if (!belge) return;

            // Form deÄŸerlerini belgeye kaydet
            const hesapKodu = document.querySelector(`.hesap-kodu[data-belge-id="${belgeId}"]`);
            const projeKodu = document.querySelector(`.proje-kodu[data-belge-id="${belgeId}"]`);
            const sirket = document.querySelector(`.sirket[data-belge-id="${belgeId}"]`);
            const aciklama = document.querySelector(`.aciklama[data-belge-id="${belgeId}"]`);

            belge.masrafDetay = {
                hesapKodu: hesapKodu ? hesapKodu.value : '',
                projeKodu: projeKodu ? projeKodu.value : '',
                sirket: sirket ? sirket.value : '',
                aciklama: aciklama ? aciklama.value : ''
            };
        }

        // Belge bazlÄ± AI hesap Ã¶nerisi
        function aiHesapOnerisiBelge(aciklama, belgeId) {
            const container = document.getElementById(`aiHesapOneriContainer-${belgeId}`);
            const textEl = document.getElementById(`aiHesapOneriText-${belgeId}`);

            if (!aciklama || aciklama.length < 5) {
                if (container) container.style.display = 'none';
                return;
            }

            // Basit AI simÃ¼lasyonu
            const lowerAciklama = aciklama.toLowerCase();
            let oneri = '';

            if (lowerAciklama.includes('yemek') || lowerAciklama.includes('kahvaltÄ±') || lowerAciklama.includes('Ã¶ÄŸle') || lowerAciklama.includes('akÅŸam')) {
                oneri = '770.01 - Yemek Giderleri';
            } else if (lowerAciklama.includes('taksi') || lowerAciklama.includes('ulaÅŸÄ±m') || lowerAciklama.includes('otobÃ¼s')) {
                oneri = '770.02 - UlaÅŸÄ±m Giderleri';
            } else if (lowerAciklama.includes('otel') || lowerAciklama.includes('konaklama') || lowerAciklama.includes('pansiyon')) {
                oneri = '770.03 - Konaklama Giderleri';
            } else if (lowerAciklama.includes('kaÄŸÄ±t') || lowerAciklama.includes('kalem') || lowerAciklama.includes('ofis') || lowerAciklama.includes('kÄ±rtasiye')) {
                oneri = '770.04 - Ofis Malzemesi';
            } else if (lowerAciklama.includes('telefon') || lowerAciklama.includes('internet') || lowerAciklama.includes('hat')) {
                oneri = '770.06 - HaberleÅŸme Giderleri';
            } else if (lowerAciklama.includes('benzin') || lowerAciklama.includes('akaryakÄ±t') || lowerAciklama.includes('araÃ§')) {
                oneri = '770.07 - TaÅŸÄ±t Giderleri';
            }

            if (oneri && container && textEl) {
                textEl.textContent = oneri;
                container.style.display = 'block';
            }
        }

        // Belge bazlÄ± AI Ã¶nerisi uygula
        function aiOneriUygulaBelge(belgeId) {
            const textEl = document.getElementById(`aiHesapOneriText-${belgeId}`);
            const hesapKodu = document.querySelector(`.hesap-kodu[data-belge-id="${belgeId}"]`);

            if (textEl && hesapKodu) {
                const oneriKodu = textEl.textContent.split(' - ')[0];
                hesapKodu.value = oneriKodu;
                masrafDetayDegisti(belgeId);
            }

            const container = document.getElementById(`aiHesapOneriContainer-${belgeId}`);
            if (container) container.style.display = 'none';
        }

        // Gider kalemi rengini al
        function getKalemRenk(kalem) {
            const renkler = {
                'GÄ±da': '#4CAF50',
                'Temizlik': '#2196F3',
                'KÄ±rtasiye': '#FF9800',
                'Mutfak': '#9C27B0',
                'UlaÅŸÄ±m': '#E91E63',
                'Konaklama': '#00BCD4',
                'BiliÅŸim': '#3F51B5',
                'DiÄŸer': '#607D8B'
            };
            return renkler[kalem] || renkler['DiÄŸer'];
        }

        // KDV oranÄ± rengini al
        function getKdvRenk(oran) {
            if (oran === 0) return '#607D8B';
            if (oran === 1) return '#9E9E9E';
            if (oran === 10) return '#4CAF50';
            if (oran === 20) return '#FF9800';
            return '#2196F3';
        }

        // ============================================
        // ESKÄ° FONKSÄ°YONLAR (geriye uyumluluk iÃ§in)
        // ============================================

        // Gider satÄ±rlarÄ±nÄ± tabloya render et (eski)
        function renderGiderSatirlari() {
            const tbody = document.getElementById('giderSatirlariBody');
            const section = document.getElementById('giderSatirlariSection');

            if (giderSatirlari.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            tbody.innerHTML = '';

            giderSatirlari.forEach((satir, index) => {
                const kdvTutar = satir.netTutar * satir.kdvOrani / 100;
                const brutTutar = satir.netTutar + kdvTutar;

                const tr = document.createElement('tr');
                tr.dataset.id = satir.id;
                tr.innerHTML = `
                    <td>
                        <input type="checkbox" class="satir-checkbox" onchange="checkSelectedRows()">
                    </td>
                    <td>
                        <span class="gider-kalemi-badge" style="background: ${getKalemRenk(satir.kalem)}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px;">
                            ${satir.kalem}
                        </span>
                    </td>
                    <td>${satir.aciklama}</td>
                    <td><code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">${satir.hesapKodu}</code></td>
                    <td style="text-align: right;">â‚º${satir.netTutar.toFixed(2)}</td>
                    <td style="text-align: center;">
                        <span class="kdv-badge" style="background: ${getKdvRenk(satir.kdvOrani)}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">
                            %${satir.kdvOrani}
                        </span>
                    </td>
                    <td style="text-align: right;">â‚º${kdvTutar.toFixed(2)}</td>
                    <td style="text-align: right; font-weight: 600;">â‚º${brutTutar.toFixed(2)}</td>
                    <td>
                        <button type="button" onclick="satirSil(${satir.id})" class="btn-icon-delete" title="SatÄ±rÄ± Ã‡Ä±kar" style="background: none; border: none; color: var(--warning-red); cursor: pointer; font-size: 16px;">
                            ğŸ—‘ï¸
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // ToplamlarÄ± gÃ¼ncelle
            hesaplaToplamlar();
            hesaplaKdvDagilimi();
        }

        // Gider kalemi rengini al
        function getKalemRenk(kalem) {
            const renkler = {
                'GÄ±da': '#4CAF50',
                'Temizlik': '#2196F3',
                'KÄ±rtasiye': '#FF9800',
                'Mutfak': '#9C27B0',
                'UlaÅŸÄ±m': '#E91E63',
                'Konaklama': '#00BCD4',
                'DiÄŸer': '#607D8B'
            };
            return renkler[kalem] || renkler['DiÄŸer'];
        }

        // KDV oranÄ± rengini al
        function getKdvRenk(oran) {
            if (oran === 0) return '#607D8B';
            if (oran === 1) return '#9E9E9E';
            if (oran === 10) return '#4CAF50';
            if (oran === 20) return '#FF9800';
            return '#2196F3';
        }

        // ToplamlarÄ± hesapla
        function hesaplaToplamlar() {
            let toplamNet = 0;
            let toplamKdv = 0;
            let toplamBrut = 0;

            giderSatirlari.forEach(satir => {
                const kdvTutar = satir.netTutar * satir.kdvOrani / 100;
                toplamNet += satir.netTutar;
                toplamKdv += kdvTutar;
                toplamBrut += satir.netTutar + kdvTutar;
            });

            document.getElementById('toplamNetTutar').textContent = 'â‚º' + toplamNet.toFixed(2);
            document.getElementById('toplamKdvTutar').textContent = 'â‚º' + toplamKdv.toFixed(2);
            document.getElementById('toplamBrutTutar').textContent = 'â‚º' + toplamBrut.toFixed(2);

            // Ana form alanlarÄ±nÄ± da gÃ¼ncelle
            document.getElementById('brutTutar').value = toplamBrut.toFixed(2);
            document.getElementById('netTutar').value = toplamNet.toFixed(2);
            document.getElementById('kdvTutari').value = toplamKdv.toFixed(2);
            updateAmountSummary();
        }

        // KDV daÄŸÄ±lÄ±mÄ±nÄ± hesapla
        function hesaplaKdvDagilimi() {
            const dagilim = {};

            giderSatirlari.forEach(satir => {
                const key = satir.kdvOrani;
                if (!dagilim[key]) {
                    dagilim[key] = { netTutar: 0, kdvTutar: 0 };
                }
                dagilim[key].netTutar += satir.netTutar;
                dagilim[key].kdvTutar += satir.netTutar * satir.kdvOrani / 100;
            });

            const container = document.getElementById('kdvDagilimi');
            container.innerHTML = '';

            Object.keys(dagilim).sort((a, b) => a - b).forEach(oran => {
                const data = dagilim[oran];
                const div = document.createElement('div');
                div.style.cssText = 'background: white; padding: 12px 16px; border-radius: 8px; border: 1px solid #e0e0e0; min-width: 140px;';
                div.innerHTML = `
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">KDV %${oran}</div>
                    <div style="font-size: 16px; font-weight: 600; color: var(--primary-orange);">â‚º${data.kdvTutar.toFixed(2)}</div>
                    <div style="font-size: 11px; color: var(--text-secondary);">Matrah: â‚º${data.netTutar.toFixed(2)}</div>
                `;
                container.appendChild(div);
            });
        }

        // SatÄ±r sil
        function satirSil(id) {
            giderSatirlari = giderSatirlari.filter(s => s.id !== id);
            renderGiderSatirlari();
            showAlert('info', 'Gider satÄ±rÄ± Ã§Ä±karÄ±ldÄ±.');
        }

        // SeÃ§ili satÄ±rlarÄ± kontrol et
        function checkSelectedRows() {
            const checkboxes = document.querySelectorAll('.satir-checkbox:checked');
            document.getElementById('btnSecilenCikar').disabled = checkboxes.length === 0;
        }

        // TÃ¼m satÄ±rlarÄ± seÃ§/kaldÄ±r
        function toggleAllRows(checkbox) {
            document.querySelectorAll('.satir-checkbox').forEach(cb => {
                cb.checked = checkbox.checked;
            });
            checkSelectedRows();
        }

        // SeÃ§ilenleri Ã§Ä±kar
        function secilenSatirlariCikar() {
            const checkboxes = document.querySelectorAll('.satir-checkbox:checked');
            const silinecekIdler = [];

            checkboxes.forEach(cb => {
                const tr = cb.closest('tr');
                silinecekIdler.push(parseInt(tr.dataset.id));
            });

            giderSatirlari = giderSatirlari.filter(s => !silinecekIdler.includes(s.id));
            document.getElementById('selectAllRows').checked = false;
            renderGiderSatirlari();
            showAlert('info', `${silinecekIdler.length} gider satÄ±rÄ± Ã§Ä±karÄ±ldÄ±.`);
        }

        // Yeni gider satÄ±rÄ± ekle (manuel)
        function yeniGiderSatiriEkle() {
            satirIdSayaci++;
            giderSatirlari.push({
                id: satirIdSayaci,
                kalem: 'DiÄŸer',
                aciklama: 'Yeni gider satÄ±rÄ±',
                hesapKodu: '770.04',
                netTutar: 0,
                kdvOrani: 20
            });
            renderGiderSatirlari();
        }

        // Karma fiÅŸ yÃ¼kle (demo)
        function karmaFisYukle() {
            const ornek = karmaGiderOrnekleri[karmaOrnekIndex];
            karmaOrnekIndex = (karmaOrnekIndex + 1) % karmaGiderOrnekleri.length;

            // Belge bilgilerini doldur
            document.getElementById('belgeTuru').value = ornek.belgeTuru;
            document.getElementById('firmaAdi').value = ornek.firmaAdi;
            document.getElementById('vergiNo').value = ornek.vergiNo;
            document.getElementById('belgeNo').value = ornek.belgeNo;
            document.getElementById('belgeTarihi').value = ornek.belgeTarihi;

            // Gider satÄ±rlarÄ±nÄ± ekle
            ornek.satirlar.forEach(satir => {
                satirIdSayaci++;
                giderSatirlari.push({
                    id: satirIdSayaci,
                    ...satir
                });
            });

            renderGiderSatirlari();
            showAlert('success', `${ornek.firmaAdi} fiÅŸi okundu! ${ornek.satirlar.length} gider satÄ±rÄ± eklendi. (Karma KDV: %10 ve %20)`);
        }

        // Demo: Karma FiÅŸ YÃ¼kle (Migros Ã–rneÄŸi) - Sayfa baÅŸÄ±ndaki test butonu iÃ§in
        function demoKarmaFisYukle() {
            // Ã–nce mevcut verileri temizle (demo iÃ§in sÄ±fÄ±rdan baÅŸla)
            giderSatirlari = [];
            yukluBelgeler = [];
            satirIdSayaci = 0;
            belgeIdSayaci = 0;

            // Migros karma fiÅŸ Ã¶rneÄŸi (GÄ±da + KÄ±rtasiye + Temizlik + karÄ±ÅŸÄ±k KDV)
            const migrosOrnek = {
                belgeTuru: 'fis',
                firmaAdi: 'MIGROS TÄ°CARET A.Å.',
                vergiNo: '9876543210',
                belgeNo: 'MIG-2024-' + Math.floor(Math.random() * 100000),
                belgeTarihi: new Date().toISOString().split('T')[0],
                ocrGuvenSkoru: 96,
                satirlar: [
                    { kalem: 'GÄ±da', aciklama: 'KahvaltÄ±lÄ±k ÃœrÃ¼nler (Peynir, Zeytin, Yumurta)', hesapKodu: '770.01', netTutar: 245.00, kdvOrani: 10 },
                    { kalem: 'GÄ±da', aciklama: 'Ä°Ã§ecekler (Su, Meyve Suyu)', hesapKodu: '770.01', netTutar: 85.00, kdvOrani: 10 },
                    { kalem: 'Temizlik', aciklama: 'Temizlik Malzemeleri (Deterjan, Ã‡amaÅŸÄ±r Suyu)', hesapKodu: '770.04', netTutar: 180.00, kdvOrani: 20 },
                    { kalem: 'KÄ±rtasiye', aciklama: 'Ofis KÄ±rtasiye (Kalem, Defter, Dosya)', hesapKodu: '770.04', netTutar: 125.00, kdvOrani: 20 },
                    { kalem: 'Mutfak', aciklama: 'Mutfak Malzemeleri (PeÃ§ete, BulaÅŸÄ±k SÃ¼ngeri)', hesapKodu: '770.04', netTutar: 65.00, kdvOrani: 20 },
                    { kalem: 'GÄ±da', aciklama: 'AtÄ±ÅŸtÄ±rmalÄ±k (BiskÃ¼vi, Ã‡ikolata)', hesapKodu: '770.01', netTutar: 95.00, kdvOrani: 10 }
                ]
            };

            // Yeni belge oluÅŸtur
            belgeIdSayaci++;
            const yeniBelge = {
                id: belgeIdSayaci,
                belgeTuru: migrosOrnek.belgeTuru,
                firmaAdi: migrosOrnek.firmaAdi,
                vergiNo: migrosOrnek.vergiNo,
                belgeNo: migrosOrnek.belgeNo,
                belgeTarihi: migrosOrnek.belgeTarihi,
                ocrGuvenSkoru: migrosOrnek.ocrGuvenSkoru,
                satirlar: []
            };

            // Belge bilgilerini forma doldur
            document.getElementById('belgeTuru').value = migrosOrnek.belgeTuru;
            document.getElementById('firmaAdi').value = migrosOrnek.firmaAdi;
            document.getElementById('vergiNo').value = migrosOrnek.vergiNo;
            document.getElementById('belgeNo').value = migrosOrnek.belgeNo;
            document.getElementById('belgeTarihi').value = migrosOrnek.belgeTarihi;

            // Gider satÄ±rlarÄ±nÄ± ekle (belge ile iliÅŸkilendir)
            migrosOrnek.satirlar.forEach(satir => {
                satirIdSayaci++;
                const yeniSatir = {
                    id: satirIdSayaci,
                    belgeId: belgeIdSayaci,
                    ...satir
                };
                yeniBelge.satirlar.push(yeniSatir);
                giderSatirlari.push(yeniSatir);
            });

            yukluBelgeler.push(yeniBelge);

            // Tabloyu ve belge listesini render et
            renderBelgelerListesi();
            renderGiderSatirlari();

            // Belgeler listesi container'Ä±nÄ± gÃ¶ster
            document.getElementById('belgelerListesiContainer').style.display = 'block';
            document.getElementById('belgeSayisi').textContent = yukluBelgeler.length + ' Belge';

            // Bilgi mesajÄ± gÃ¶ster
            showAlert('success', 'ğŸ›’ Migros karma fiÅŸi yÃ¼klendi! 6 gider satÄ±rÄ±: 3 GÄ±da (%10 KDV), 3 Temizlik/KÄ±rtasiye/Mutfak (%20 KDV). "Yeni Belge Ekle" ile daha fazla belge ekleyebilirsiniz.');

            // Gider satÄ±rlarÄ± section'Ä±na scroll yap
            setTimeout(() => {
                document.getElementById('giderSatirlariSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 300);
        }

        // Yeni belge ekle - Ã‡oklu belge desteÄŸi
        function yeniBelgeEkle() {
            const ornek = karmaGiderOrnekleri[karmaOrnekIndex];
            karmaOrnekIndex = (karmaOrnekIndex + 1) % karmaGiderOrnekleri.length;

            belgeIdSayaci++;
            const yeniBelge = {
                id: belgeIdSayaci,
                belgeTuru: ornek.belgeTuru,
                firmaAdi: ornek.firmaAdi,
                vergiNo: ornek.vergiNo,
                belgeNo: ornek.belgeNo,
                belgeTarihi: ornek.belgeTarihi,
                ocrGuvenSkoru: ornek.ocrGuvenSkoru || 95,
                satirlar: []
            };

            // Bu belgeye ait satÄ±rlarÄ± ekle
            ornek.satirlar.forEach(satir => {
                satirIdSayaci++;
                const yeniSatir = {
                    id: satirIdSayaci,
                    belgeId: belgeIdSayaci,
                    ...satir
                };
                yeniBelge.satirlar.push(yeniSatir);
                giderSatirlari.push(yeniSatir);
            });

            yukluBelgeler.push(yeniBelge);

            // Belge listesini ve gider satÄ±rlarÄ±nÄ± render et
            renderBelgelerListesi();
            renderGiderSatirlari();

            // Belge sayÄ±sÄ±nÄ± gÃ¼ncelle
            document.getElementById('belgeSayisi').textContent = yukluBelgeler.length + ' Belge';
            document.getElementById('belgelerListesiContainer').style.display = 'block';

            showAlert('success', `ğŸ“„ ${ornek.firmaAdi} belgesi eklendi! ${ornek.satirlar.length} gider satÄ±rÄ±. Toplam ${yukluBelgeler.length} belge.`);
        }

        // Belge listesini render et
        function renderBelgelerListesi() {
            const container = document.getElementById('belgelerListesi');
            container.innerHTML = '';

            yukluBelgeler.forEach(belge => {
                const belgeToplam = belge.satirlar.reduce((acc, s) => {
                    const kdvTutar = s.netTutar * s.kdvOrani / 100;
                    return acc + s.netTutar + kdvTutar;
                }, 0);

                const div = document.createElement('div');
                div.className = 'belge-karti';
                div.style.cssText = 'background: #f8f9fa; padding: 12px 16px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--primary-orange);';
                div.innerHTML = `
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 14px; color: var(--text-primary);">${belge.firmaAdi}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            ${belge.belgeNo} â€¢ ${belge.satirlar.length} satÄ±r â€¢
                            <strong style="color: var(--primary-orange);">â‚º${belgeToplam.toFixed(2)}</strong>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <span style="background: #e8f5e9; color: #2e7d32; padding: 4px 8px; border-radius: 4px; font-size: 11px;">
                            %${belge.ocrGuvenSkoru} OCR
                        </span>
                        <button type="button" onclick="belgeSil(${belge.id})" class="btn-icon-delete" title="Belgeyi KaldÄ±r"
                            style="background: #ffebee; border: none; color: var(--warning-red); cursor: pointer; padding: 6px 10px; border-radius: 4px; font-size: 14px;">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Belge sil (ve ona ait satÄ±rlarÄ± da sil)
        function belgeSil(belgeId) {
            const belge = yukluBelgeler.find(b => b.id === belgeId);
            if (!belge) return;

            if (confirm(`"${belge.firmaAdi}" belgesini ve tÃ¼m gider satÄ±rlarÄ±nÄ± silmek istediÄŸinize emin misiniz?`)) {
                // Belgeye ait satÄ±rlarÄ± sil
                giderSatirlari = giderSatirlari.filter(s => s.belgeId !== belgeId);
                // Belgeyi sil
                yukluBelgeler = yukluBelgeler.filter(b => b.id !== belgeId);

                // Yeniden render et
                renderBelgelerListesi();
                renderGiderSatirlari();

                // Belge sayÄ±sÄ±nÄ± gÃ¼ncelle
                document.getElementById('belgeSayisi').textContent = yukluBelgeler.length + ' Belge';

                if (yukluBelgeler.length === 0) {
                    document.getElementById('belgelerListesiContainer').style.display = 'none';
                }

                showAlert('info', `"${belge.firmaAdi}" belgesi ve ${belge.satirlar.length} gider satÄ±rÄ± kaldÄ±rÄ±ldÄ±.`);
            }
        }

        // ============================================
        // MAÄAZA MASRAFI VE ATF KARGO TAKÄ°P
        // ============================================

        // MaÄŸaza masrafÄ± toggle
        function toggleMagazaMasrafi() {
            const checkbox = document.getElementById('magazaMasrafiCheckbox');
            const normalAkis = document.getElementById('normalOnayAkisi');
            const magazaAkis = document.getElementById('magazaOnayAkisi');
            const atfAlani = document.getElementById('atfKargoAlani');

            if (checkbox.checked) {
                normalAkis.style.display = 'none';
                magazaAkis.style.display = 'flex';
                atfAlani.style.display = 'block';
                showAlert('info', 'ğŸ“¦ MaÄŸaza masrafÄ± seÃ§ildi. Kargo takip sÃ¼reci uygulanacaktÄ±r.');
            } else {
                normalAkis.style.display = 'flex';
                magazaAkis.style.display = 'none';
                atfAlani.style.display = 'none';
            }
        }

        // ATF numarasÄ± doÄŸrulama ve kargo takip
        function validateATFNumarasi() {
            const atfInput = document.getElementById('atfNumarasi');
            const kargoSirketi = document.getElementById('kargoSirketi');
            const kargoDurumu = document.getElementById('kargoDurumu');

            if (atfInput.value && kargoSirketi.value) {
                // SimÃ¼le edilmiÅŸ kargo takip
                kargoDurumu.innerHTML = `
                    <span class="status-badge status-approved">Teslim Edildi</span>
                    <span style="font-size: 12px; color: var(--text-secondary); margin-left: 8px;">
                        ${kargoSirketi.options[kargoSirketi.selectedIndex].text} - ${atfInput.value}
                    </span>
                `;
                showAlert('success', 'âœ… Kargo teslim bilgisi alÄ±ndÄ±. Masraf artÄ±k muhasebe onayÄ±na iletilecektir.');
                return true;
            }
            return false;
        }

        // ATF kargo sitesi linki
        function getKargoTakipLinki(kargoSirketi, atfNo) {
            const linkler = {
                'yurtici': `https://www.yurticikargo.com/tr/online-servisler/gonderi-sorgula?code=${atfNo}`,
                'aras': `https://www.araskargo.com.tr/trs/kargotakip?kargono=${atfNo}`,
                'mng': `https://www.mngkargo.com.tr/gonderi-takip/${atfNo}`,
                'ptt': `https://gonderitakip.ptt.gov.tr/Tracking/${atfNo}`,
                'ups': `https://www.ups.com/track?tracknum=${atfNo}`
            };
            return linkler[kargoSirketi] || '#';
        }

        // FarklÄ± belge tÃ¼rleri iÃ§in Ã¶rnek OCR verileri (satÄ±r bazlÄ±)
        const sampleOCRDatasets = [
            {
                belgeTuru: 'fis',
                masrafTipi: 'normal',
                firmaAdi: 'KARADENIZ SOFRASI',
                vergiNo: '1234567890',
                belgeNo: 'YKF-2024-847521',
                belgeTarihi: '2024-12-09',
                brutTutar: 585.00,
                kdvOrani: 10,
                kdvTutari: 53.18,
                netTutar: 531.82,
                masrafTuru: '770.01',
                ocrGuvenSkoru: 94,
                receiptItems: [
                    { name: '2x KarÄ±ÅŸÄ±k Izgara', price: 'â‚º380.00' },
                    { name: '2x Pilav', price: 'â‚º60.00' },
                    { name: '2x Ä°Ã§ecek', price: 'â‚º50.00' },
                    { name: '1x KÃ¼nefe', price: 'â‚º95.00' }
                ],
                satirlar: [
                    { kalem: 'GÄ±da', aciklama: '2x KarÄ±ÅŸÄ±k Izgara', hesapKodu: '770.01', netTutar: 345.45, kdvOrani: 10 },
                    { kalem: 'GÄ±da', aciklama: '2x Pilav', hesapKodu: '770.01', netTutar: 54.55, kdvOrani: 10 },
                    { kalem: 'GÄ±da', aciklama: '2x Ä°Ã§ecek', hesapKodu: '770.01', netTutar: 45.45, kdvOrani: 10 },
                    { kalem: 'GÄ±da', aciklama: '1x KÃ¼nefe', hesapKodu: '770.01', netTutar: 86.36, kdvOrani: 10 }
                ]
            },
            {
                belgeTuru: 'fatura',
                masrafTipi: 'normal',
                firmaAdi: 'MIGROS TÄ°CARET A.Å.',
                vergiNo: '9876543210',
                belgeNo: 'FTR-2024-158742',
                belgeTarihi: '2024-12-10',
                brutTutar: 1250.00,
                kdvOrani: 20,
                kdvTutari: 208.33,
                netTutar: 1041.67,
                masrafTuru: '770.04',
                ocrGuvenSkoru: 97,
                receiptItems: [
                    { name: 'Ofis KÄ±rtasiye Malz.', price: 'â‚º450.00' },
                    { name: 'Temizlik Malzemeleri', price: 'â‚º320.00' },
                    { name: 'Mutfak GereÃ§leri', price: 'â‚º280.00' },
                    { name: 'Su ve Ä°Ã§ecek', price: 'â‚º200.00' }
                ],
                // Karma gider kalemleri - farklÄ± KDV oranlarÄ±
                satirlar: [
                    { kalem: 'KÄ±rtasiye', aciklama: 'Ofis KÄ±rtasiye Malz.', hesapKodu: '770.04', netTutar: 375.00, kdvOrani: 20 },
                    { kalem: 'Temizlik', aciklama: 'Temizlik Malzemeleri', hesapKodu: '770.04', netTutar: 266.67, kdvOrani: 20 },
                    { kalem: 'Mutfak', aciklama: 'Mutfak GereÃ§leri', hesapKodu: '770.04', netTutar: 233.33, kdvOrani: 20 },
                    { kalem: 'GÄ±da', aciklama: 'Su ve Ä°Ã§ecek', hesapKodu: '770.01', netTutar: 181.82, kdvOrani: 10 }
                ]
            },
            {
                belgeTuru: 'fis',
                masrafTipi: 'seyahat',
                firmaAdi: 'UBER TURKEY',
                vergiNo: '5554443332',
                belgeNo: 'UBR-2024-984521',
                belgeTarihi: '2024-12-11',
                brutTutar: 245.00,
                kdvOrani: 10,
                kdvTutari: 22.27,
                netTutar: 222.73,
                masrafTuru: '770.02',
                ocrGuvenSkoru: 92,
                receiptItems: [
                    { name: 'HavalimanÄ± Transfer', price: 'â‚º185.00' },
                    { name: 'Servis Bedeli', price: 'â‚º35.00' },
                    { name: 'BahÅŸiÅŸ', price: 'â‚º25.00' }
                ],
                satirlar: [
                    { kalem: 'UlaÅŸÄ±m', aciklama: 'HavalimanÄ± Transfer', hesapKodu: '770.02', netTutar: 168.18, kdvOrani: 10 },
                    { kalem: 'UlaÅŸÄ±m', aciklama: 'Servis Bedeli', hesapKodu: '770.02', netTutar: 31.82, kdvOrani: 10 },
                    { kalem: 'UlaÅŸÄ±m', aciklama: 'BahÅŸiÅŸ', hesapKodu: '770.02', netTutar: 22.73, kdvOrani: 10 }
                ]
            },
            {
                belgeTuru: 'fatura',
                masrafTipi: 'normal',
                firmaAdi: 'HILTON ISTANBUL',
                vergiNo: '1112223334',
                belgeNo: 'HTL-2024-005847',
                belgeTarihi: '2024-12-08',
                brutTutar: 3500.00,
                kdvOrani: 10,
                kdvTutari: 318.18,
                netTutar: 3181.82,
                masrafTuru: '770.03',
                ocrGuvenSkoru: 98,
                receiptItems: [
                    { name: '2 Gece Konaklama', price: 'â‚º3,000.00' },
                    { name: 'KahvaltÄ± Dahil', price: 'â‚º0.00' },
                    { name: 'Otopark Ãœcreti', price: 'â‚º200.00' },
                    { name: 'Minibar', price: 'â‚º300.00' }
                ],
                satirlar: [
                    { kalem: 'Konaklama', aciklama: '2 Gece Konaklama', hesapKodu: '770.03', netTutar: 2727.27, kdvOrani: 10 },
                    { kalem: 'Konaklama', aciklama: 'Otopark Ãœcreti', hesapKodu: '770.03', netTutar: 181.82, kdvOrani: 10 },
                    { kalem: 'GÄ±da', aciklama: 'Minibar', hesapKodu: '770.01', netTutar: 272.73, kdvOrani: 10 }
                ]
            },
            {
                belgeTuru: 'fatura',
                masrafTipi: 'normal',
                firmaAdi: 'AMAZON WEB SERVICES',
                vergiNo: '7778889990',
                belgeNo: 'AWS-2024-INV-45821',
                belgeTarihi: '2024-12-01',
                brutTutar: 8500.00,
                kdvOrani: 20,
                kdvTutari: 1416.67,
                netTutar: 7083.33,
                masrafTuru: '740.01',
                ocrGuvenSkoru: 99,
                receiptItems: [
                    { name: 'EC2 Instance', price: 'â‚º4,500.00' },
                    { name: 'S3 Storage', price: 'â‚º1,200.00' },
                    { name: 'RDS Database', price: 'â‚º2,000.00' },
                    { name: 'Data Transfer', price: 'â‚º800.00' }
                ],
                satirlar: [
                    { kalem: 'BiliÅŸim', aciklama: 'EC2 Instance', hesapKodu: '740.01', netTutar: 3750.00, kdvOrani: 20 },
                    { kalem: 'BiliÅŸim', aciklama: 'S3 Storage', hesapKodu: '740.01', netTutar: 1000.00, kdvOrani: 20 },
                    { kalem: 'BiliÅŸim', aciklama: 'RDS Database', hesapKodu: '740.01', netTutar: 1666.67, kdvOrani: 20 },
                    { kalem: 'BiliÅŸim', aciklama: 'Data Transfer', hesapKodu: '740.01', netTutar: 666.67, kdvOrani: 20 }
                ]
            }
        ];

        // Aktif OCR verisi (deÄŸiÅŸtirilebilir)
        let currentOCRIndex = 0;
        let ocrData = sampleOCRDatasets[currentOCRIndex];

        // OCR ile form alanlarÄ±nÄ± otomatik doldur
        function fillFormFromOCR() {
            // 1. Belge TÃ¼rÃ¼ ve Masraf Tipi otomatik doldur
            document.getElementById('belgeTuru').value = ocrData.belgeTuru;
            document.getElementById('masrafTipi').value = ocrData.masrafTipi;

            // 2. Belge Bilgileri otomatik doldur
            document.getElementById('firmaAdi').value = ocrData.firmaAdi;
            document.getElementById('vergiNo').value = ocrData.vergiNo;
            document.getElementById('belgeNo').value = ocrData.belgeNo;
            document.getElementById('belgeTarihi').value = ocrData.belgeTarihi;

            // 3. Tutar Bilgileri otomatik doldur
            document.getElementById('brutTutar').value = ocrData.brutTutar.toFixed(2);
            document.getElementById('kdvOrani').value = ocrData.kdvOrani;
            document.getElementById('kdvTutari').value = ocrData.kdvTutari.toFixed(2);
            document.getElementById('netTutar').value = ocrData.netTutar.toFixed(2);

            // 4. Masraf TÃ¼rÃ¼ / Hesap Kodu otomatik doldur ve KÄ°LÄ°TLE
            const hesapKoduSelect = document.getElementById('hesapKodu');
            hesapKoduSelect.value = ocrData.masrafTuru;
            hesapKoduSelect.disabled = true;
            hesapKoduSelect.style.backgroundColor = '#e8f5e9';
            hesapKoduSelect.style.border = '2px solid #4CAF50';
            hesapKoduSelect.style.cursor = 'not-allowed';

            // Masraf tÃ¼rÃ¼ alanÄ±na OCR kilidi bilgisi ekle
            addOCRLockIndicator();

            // Summary alanlarÄ±nÄ± gÃ¼ncelle
            document.getElementById('summaryBrut').textContent = ocrData.brutTutar.toFixed(2) + ' TL';
            document.getElementById('summaryKdv').textContent = ocrData.kdvTutari.toFixed(2) + ' TL';
            document.getElementById('summaryNet').textContent = ocrData.netTutar.toFixed(2) + ' TL';
            document.getElementById('summaryTotal').textContent = ocrData.brutTutar.toFixed(2) + ' TL';

            // OCR gÃ¼ven skoru gÃ¼ncelle
            document.getElementById('ocrConfidenceTag').textContent = '%' + ocrData.ocrGuvenSkoru + ' BaÅŸarÄ±lÄ±';

            // 5. SatÄ±r bazlÄ± gider detaylarÄ±nÄ± ekle
            if (ocrData.satirlar && ocrData.satirlar.length > 0) {
                ocrData.satirlar.forEach(satir => {
                    satirIdSayaci++;
                    giderSatirlari.push({
                        id: satirIdSayaci,
                        ...satir
                    });
                });
                renderGiderSatirlari();
            }

            // 6. Cari durumu kontrolÃ¼ (fatura tÃ¼rÃ¼ iÃ§in)
            const belgeTuru = document.getElementById('belgeTuru').value;
            const faturaTurleri = ['fatura', 'tevkifatli', 'yurtdisi', 'su', 'gider_pusulasi'];
            const cariDurumuRow = document.getElementById('cariDurumuRow');
            if (faturaTurleri.includes(belgeTuru)) {
                cariDurumuRow.style.display = 'block';
                checkCariDurumu();
            } else {
                cariDurumuRow.style.display = 'none';
            }
        }

        // OCR kilidi gÃ¶stergesi ekle
        function addOCRLockIndicator() {
            const hesapKoduGroup = document.getElementById('hesapKodu').closest('.form-group');

            // Ã–nceki kilit gÃ¶stergesini kaldÄ±r
            const existingLock = hesapKoduGroup.querySelector('.ocr-lock-indicator');
            if (existingLock) existingLock.remove();

            // Yeni kilit gÃ¶stergesi ekle
            const lockIndicator = document.createElement('div');
            lockIndicator.className = 'ocr-lock-indicator';
            lockIndicator.innerHTML = `
                <span style="display: inline-flex; align-items: center; gap: 6px; margin-top: 8px; padding: 6px 12px; background: linear-gradient(135deg, #e8f5e9, #c8e6c9); border-radius: 6px; font-size: 12px; color: #2e7d32; border: 1px solid #a5d6a7;">
                    ğŸ”’ OCR tarafÄ±ndan otomatik belirlendi (DeÄŸiÅŸtirilemez)
                </span>
            `;
            hesapKoduGroup.appendChild(lockIndicator);
        }

        // FiÅŸ Ã¶nizleme gÃ¶rselini gÃ¼ncelle
        function updateReceiptPreview() {
            const receiptSimple = document.getElementById('receiptSimple');

            // Masraf tÃ¼rÃ¼ adÄ±nÄ± al
            const masrafTuruAdi = getMasrafTuruAdi(ocrData.masrafTuru);

            // FiÅŸ iÃ§eriÄŸini gÃ¼ncelle
            let itemsHtml = '';
            ocrData.receiptItems.forEach(item => {
                itemsHtml += `
                    <div class="receipt-simple-item">
                        <span>${item.name}</span>
                        <span>${item.price}</span>
                    </div>
                `;
            });

            receiptSimple.innerHTML = `
                <div class="receipt-simple-header">
                    <strong class="receipt-simple-company">${ocrData.firmaAdi}</strong>
                    <span class="receipt-simple-sub">${masrafTuruAdi}</span>
                </div>
                <div class="receipt-simple-divider"></div>
                <div class="receipt-simple-info">
                    VKN: ${ocrData.vergiNo}<br>
                    Tarih: ${formatDate(ocrData.belgeTarihi)}<br>
                    FiÅŸ No: ${ocrData.belgeNo}
                </div>
                <div class="receipt-simple-divider"></div>
                <div class="receipt-simple-items">
                    ${itemsHtml}
                </div>
                <div class="receipt-simple-totals">
                    <div class="receipt-simple-item">
                        <span>KDV (%${ocrData.kdvOrani})</span>
                        <span>â‚º${ocrData.kdvTutari.toFixed(2)}</span>
                    </div>
                    <div class="receipt-simple-item total">
                        <strong>TOPLAM</strong>
                        <strong>â‚º${ocrData.brutTutar.toFixed(2)}</strong>
                    </div>
                </div>
                <div class="receipt-simple-footer">
                    * TEÅEKKÃœRLER *<br>
                    Bu belge mali deÄŸer taÅŸÄ±r
                </div>
            `;

            // OCR baÅŸarÄ± bÃ¶lÃ¼mÃ¼ndeki Ã¶nizlemeyi de gÃ¼ncelle
            const extractedPreview = document.querySelector('.ocr-extracted-preview');
            if (extractedPreview) {
                extractedPreview.innerHTML = `
                    <div class="extracted-item">
                        <span class="extracted-label">Firma:</span>
                        <span class="extracted-value">${ocrData.firmaAdi}</span>
                    </div>
                    <div class="extracted-item">
                        <span class="extracted-label">Tarih:</span>
                        <span class="extracted-value">${formatDate(ocrData.belgeTarihi)}</span>
                    </div>
                    <div class="extracted-item">
                        <span class="extracted-label">Tutar:</span>
                        <span class="extracted-value highlight">â‚º${ocrData.brutTutar.toFixed(2)}</span>
                    </div>
                `;
            }
        }

        // Masraf tÃ¼rÃ¼ adÄ±nÄ± getir
        function getMasrafTuruAdi(kod) {
            const masrafTurleri = {
                '770.01': 'Yemek Giderleri',
                '770.02': 'UlaÅŸÄ±m Giderleri',
                '770.03': 'Konaklama Giderleri',
                '770.04': 'Ofis Malzemesi',
                '770.05': 'Temsil AÄŸÄ±rlama',
                '770.06': 'HaberleÅŸme Giderleri',
                '770.07': 'TaÅŸÄ±t Giderleri',
                '740.01': 'YazÄ±lÄ±m Giderleri',
                '740.02': 'DonanÄ±m BakÄ±m',
                '740.03': 'IT Destek Hizmetleri'
            };
            return masrafTurleri[kod] || 'Masraf';
        }

        // Tarih formatla
        function formatDate(dateStr) {
            const parts = dateStr.split('-');
            if (parts.length === 3) {
                return `${parts[2]}.${parts[1]}.${parts[0]}`;
            }
            return dateStr;
        }

        // FarklÄ± belge yÃ¼kle butonu
        function retakePhoto() {
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.classList.remove('collapsed');
            uploadArea.style.display = 'block';

            // File input'u tetikle
            document.getElementById('fileInput').click();
        }

        // Dosya yÃ¼kleme iÅŸleyicisi
        document.getElementById('fileInput').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                // Yeni belge yÃ¼klendi - rastgele bir OCR verisi seÃ§ (demo iÃ§in)
                currentOCRIndex = (currentOCRIndex + 1) % sampleOCRDatasets.length;
                ocrData = sampleOCRDatasets[currentOCRIndex];

                // OCR iÅŸlemini baÅŸlat
                simulateNewOCR(e.target.files[0].name);
            }
        });

        // Yeni OCR iÅŸlemi simÃ¼lasyonu
        function simulateNewOCR(fileName) {
            const ocrProcessing = document.getElementById('ocrProcessing');
            const ocrSuccess = document.getElementById('ocrSuccess');
            const documentPreviewCard = document.getElementById('documentPreviewCard');
            const uploadArea = document.getElementById('uploadArea');

            // Upload alanÄ±nÄ± gizle
            uploadArea.style.display = 'none';
            uploadArea.classList.add('collapsed');

            // Ä°ÅŸleniyor animasyonunu gÃ¶ster
            documentPreviewCard.style.display = 'none';
            ocrSuccess.style.display = 'none';
            ocrProcessing.style.display = 'block';

            // Step'leri sÄ±fÄ±rla
            const steps = ['step1', 'step2', 'step3', 'step4'];
            steps.forEach(step => document.getElementById(step).classList.remove('active'));

            let currentStep = 0;

            const stepInterval = setInterval(() => {
                if (currentStep < steps.length) {
                    document.getElementById(steps[currentStep]).classList.add('active');
                    currentStep++;
                } else {
                    clearInterval(stepInterval);

                    setTimeout(() => {
                        ocrProcessing.style.display = 'none';
                        ocrSuccess.style.display = 'block';
                        documentPreviewCard.style.display = 'block';

                        // FiÅŸ Ã¶nizlemesini gÃ¼ncelle
                        updateReceiptPreview();

                        // Form alanlarÄ±nÄ± doldur
                        fillFormFromOCR();

                        // BaÅŸarÄ± mesajÄ±
                        const masrafTuruAdi = getMasrafTuruAdi(ocrData.masrafTuru);
                        showAlert('success', `Yeni belge okundu: "${ocrData.firmaAdi}" - Masraf tÃ¼rÃ¼ "${masrafTuruAdi}" olarak belirlendi ve kilitlendi.`);
                    }, 500);
                }
            }, 400);
        }

        // OCR iÅŸlemi simÃ¼lasyonu (Tekrar Oku butonu iÃ§in)
        function processOCR() {
            const ocrProcessing = document.getElementById('ocrProcessing');
            const ocrSuccess = document.getElementById('ocrSuccess');
            const documentPreviewCard = document.getElementById('documentPreviewCard');

            // Yeni OCR verisine geÃ§ (bir sonraki belge tÃ¼rÃ¼)
            currentOCRIndex = (currentOCRIndex + 1) % sampleOCRDatasets.length;
            ocrData = sampleOCRDatasets[currentOCRIndex];

            // Ä°ÅŸleniyor animasyonunu gÃ¶ster
            documentPreviewCard.style.display = 'none';
            ocrSuccess.style.display = 'none';
            ocrProcessing.style.display = 'block';

            // Step'leri sÄ±fÄ±rla
            const steps = ['step1', 'step2', 'step3', 'step4'];
            steps.forEach(step => document.getElementById(step).classList.remove('active'));

            let currentStep = 0;

            const stepInterval = setInterval(() => {
                if (currentStep < steps.length) {
                    document.getElementById(steps[currentStep]).classList.add('active');
                    currentStep++;
                } else {
                    clearInterval(stepInterval);

                    // Ä°ÅŸlem tamamlandÄ± - formu doldur
                    setTimeout(() => {
                        ocrProcessing.style.display = 'none';
                        ocrSuccess.style.display = 'block';
                        documentPreviewCard.style.display = 'block';

                        // FiÅŸ Ã¶nizlemesini gÃ¼ncelle
                        updateReceiptPreview();

                        // Form alanlarÄ±nÄ± doldur
                        fillFormFromOCR();

                        // BaÅŸarÄ± mesajÄ±
                        const masrafTuruAdi = getMasrafTuruAdi(ocrData.masrafTuru);
                        showAlert('success', `OCR baÅŸarÄ±lÄ±! "${ocrData.firmaAdi}" - Masraf tÃ¼rÃ¼ "${masrafTuruAdi}" (${ocrData.masrafTuru}) olarak belirlendi ve kilitlendi.`);
                    }, 500);
                }
            }, 400);
        }

        // Sayfa yÃ¼klendiÄŸinde OCR verilerini otomatik doldur
        document.addEventListener('DOMContentLoaded', function() {
            // YÃ¶netici kontrolÃ¼nÃ¼ yap
            checkManagerView();

            // Sayfa yÃ¼klendiÄŸinde OCR verilerini otomatik doldur
            setTimeout(() => {
                fillFormFromOCR();
                updateReceiptPreview();
            }, 500);
        });

        // Show/hide fields based on belge tÃ¼rÃ¼
        document.getElementById('belgeTuru').addEventListener('change', function() {
            const yurtdisiAlanlari = document.getElementById('yurtdisiAlanlari');
            const tevkifatAlanlari = document.getElementById('tevkifatAlanlari');
            const cariDurumuRow = document.getElementById('cariDurumuRow');

            // YurtdÄ±ÅŸÄ± alanlarÄ±
            if (this.value === 'yurtdisi') {
                yurtdisiAlanlari.style.display = 'block';
            } else {
                yurtdisiAlanlari.style.display = 'none';
            }

            // Tevkifat alanlarÄ±
            if (this.value === 'tevkifatli') {
                tevkifatAlanlari.style.display = 'block';
            } else {
                tevkifatAlanlari.style.display = 'none';
                document.getElementById('tevkifatOrani').value = '0';
                document.getElementById('tevkifatTutari').value = '';
            }

            // Cari Durumu - Sadece fatura tÃ¼rlerinde gÃ¶ster (fiÅŸ hariÃ§)
            const faturaTurleri = ['fatura', 'tevkifatli', 'yurtdisi', 'su', 'gider_pusulasi'];
            if (faturaTurleri.includes(this.value)) {
                cariDurumuRow.style.display = 'block';
                // Cari kontrol simÃ¼lasyonu
                checkCariDurumu();
            } else {
                cariDurumuRow.style.display = 'none';
            }
        });

        // Cari durumu kontrol fonksiyonu
        function checkCariDurumu() {
            const vergiNo = document.getElementById('vergiNo').value;
            const cariDurum = document.getElementById('cariDurum');
            const cariKoduText = document.getElementById('cariKoduText');
            const cariEksikUyari = document.getElementById('cariEksikUyari');

            // SimÃ¼lasyon: BazÄ± VKN'ler iÃ§in cari mevcut, bazÄ±larÄ± iÃ§in eksik
            const cariMevcutVKNler = ['1234567890', '9876543210', '1111111111', '7891234560'];

            if (cariMevcutVKNler.includes(vergiNo)) {
                cariDurum.textContent = 'Cari Mevcut';
                cariDurum.className = 'status-badge status-approved';
                cariKoduText.style.display = 'inline';
                cariEksikUyari.style.display = 'none';
            } else if (vergiNo) {
                cariDurum.textContent = 'Cari Gerekli';
                cariDurum.className = 'status-badge status-pending';
                cariKoduText.style.display = 'none';
                cariEksikUyari.style.display = 'block';
            }
        }

        // Vergi no deÄŸiÅŸtiÄŸinde cari durumunu kontrol et
        document.getElementById('vergiNo').addEventListener('change', function() {
            const belgeTuru = document.getElementById('belgeTuru').value;
            const faturaTurleri = ['fatura', 'tevkifatli', 'yurtdisi', 'su', 'gider_pusulasi'];
            if (faturaTurleri.includes(belgeTuru)) {
                checkCariDurumu();
            }
        });

        // Show/hide TaÅŸÄ±t Gideri alanlarÄ± based on hesap kodu
        document.getElementById('hesapKodu').addEventListener('change', function() {
            const tasitGideriAlanlari = document.getElementById('tasitGideriAlanlari');

            if (this.value === '770.07') {
                tasitGideriAlanlari.style.display = 'block';
                updateTasitGideri();
            } else {
                tasitGideriAlanlari.style.display = 'none';
                document.getElementById('giderKismi').value = '';
                document.getElementById('kkegKismi').value = '';
            }
        });

        // Tevkifat hesaplama fonksiyonu
        function updateTevkifat() {
            const kdvTutari = parseFloat(document.getElementById('kdvTutari').value) || 0;
            const tevkifatOrani = document.getElementById('tevkifatOrani').value;

            if (tevkifatOrani && tevkifatOrani !== '0') {
                const [pay, payda] = tevkifatOrani.split('/').map(Number);
                const tevkifatTutari = kdvTutari * (pay / payda);
                document.getElementById('tevkifatTutari').value = tevkifatTutari.toFixed(2);
            } else {
                document.getElementById('tevkifatTutari').value = '';
            }
        }

        // TaÅŸÄ±t Gideri %70/%30 ayrÄ±mÄ± hesaplama fonksiyonu
        function updateTasitGideri() {
            const netTutar = parseFloat(document.getElementById('netTutar').value) || 0;
            const hesapKodu = document.getElementById('hesapKodu').value;

            if (hesapKodu === '770.07' && netTutar > 0) {
                const giderKismi = netTutar * 0.70;
                const kkegKismi = netTutar * 0.30;

                document.getElementById('giderKismi').value = giderKismi.toFixed(2);
                document.getElementById('kkegKismi').value = kkegKismi.toFixed(2);
            }
        }

        // Override updateAmountSummary to also update tevkifat and tasit gideri
        const originalUpdateAmountSummary = window.updateAmountSummary || function() {};
        window.updateAmountSummary = function() {
            originalUpdateAmountSummary();

            // Tutar alanlarÄ± gÃ¼ncelle
            const brutTutar = parseFloat(document.getElementById('brutTutar').value) || 0;
            const kdvOrani = parseFloat(document.getElementById('kdvOrani').value) || 0;

            const kdvHaricTutar = brutTutar / (1 + kdvOrani / 100);
            const kdvTutari = brutTutar - kdvHaricTutar;

            document.getElementById('kdvTutari').value = kdvTutari.toFixed(2);
            document.getElementById('netTutar').value = kdvHaricTutar.toFixed(2);

            // Summary alanlarÄ± gÃ¼ncelle
            document.getElementById('summaryBrut').textContent = brutTutar.toFixed(2) + ' TL';
            document.getElementById('summaryKdv').textContent = kdvTutari.toFixed(2) + ' TL';
            document.getElementById('summaryNet').textContent = kdvHaricTutar.toFixed(2) + ' TL';
            document.getElementById('summaryTotal').textContent = brutTutar.toFixed(2) + ' TL';

            // Tevkifat gÃ¼ncelle
            if (document.getElementById('belgeTuru').value === 'tevkifatli') {
                updateTevkifat();
            }

            // TaÅŸÄ±t gideri gÃ¼ncelle
            if (document.getElementById('hesapKodu').value === '770.07') {
                updateTasitGideri();
            }

            // Tutar limiti kontrolÃ¼
            checkTutarLimiti(brutTutar);
        };

        // ============================================
        // KURAL SETLERÄ° - VALÄ°DASYON FONKSÄ°YONLARI
        // ============================================

        // Kural 1: Tutar Limiti KontrolÃ¼ (DeÄŸiÅŸtirilebilir)
        const TUTAR_LIMITI = 50000; // TL (ayarlanabilir)

        function checkTutarLimiti(tutar) {
            const alertContainer = document.getElementById('alertContainer');
            const existingLimitAlert = document.getElementById('limitAlert');

            if (tutar > TUTAR_LIMITI) {
                if (!existingLimitAlert) {
                    const alert = document.createElement('div');
                    alert.id = 'limitAlert';
                    alert.className = 'alert alert-error';
                    alert.innerHTML = `
                        <span class="alert-icon">ğŸš«</span>
                        <div>
                            <strong>Tutar Limiti AÅŸÄ±ldÄ±!</strong><br>
                            Masraf tutarÄ± belirlenen limit olan <strong>${TUTAR_LIMITI.toLocaleString('tr-TR')} TL</strong>'yi aÅŸmaktadÄ±r.
                            Bu masraf otomatik olarak onaylanamaz.
                        </div>
                    `;
                    alertContainer.appendChild(alert);
                }
            } else if (existingLimitAlert) {
                existingLimitAlert.remove();
            }
        }

        // Kural 2: Kabul Edilmeyen Gider Kalemleri (DeÄŸiÅŸtirilebilir)
        const REDDEDILEN_GIDER_KALEMLERI = [
            'tekel', 'alkol', 'sigara', 'tÃ¼tÃ¼n', 'iÃ§ki', 'bira', 'ÅŸarap', 'rakÄ±',
            'viski', 'votka', 'kumar', 'bahis', 'casino'
        ];

        function checkYasakliGiderKalemi(aciklama) {
            const alertContainer = document.getElementById('alertContainer');
            const existingGiderAlert = document.getElementById('giderAlert');
            const lowercaseAciklama = aciklama.toLowerCase();

            const bulunanYasakli = REDDEDILEN_GIDER_KALEMLERI.find(kalem =>
                lowercaseAciklama.includes(kalem)
            );

            if (bulunanYasakli) {
                if (!existingGiderAlert) {
                    const alert = document.createElement('div');
                    alert.id = 'giderAlert';
                    alert.className = 'alert alert-error';
                    alert.innerHTML = `
                        <span class="alert-icon">â›”</span>
                        <div>
                            <strong>Kabul Edilmeyen Gider Kalemi!</strong><br>
                            AÃ§Ä±klamada kabul edilmeyen gider kalemi tespit edildi: <strong>"${bulunanYasakli}"</strong><br>
                            <small>Bu tÃ¼r masraflar ÅŸirket politikasÄ± gereÄŸi kabul edilmemektedir.</small>
                        </div>
                    `;
                    alertContainer.appendChild(alert);
                }
                return false;
            } else if (existingGiderAlert) {
                existingGiderAlert.remove();
            }
            return true;
        }

        // AÃ§Ä±klama alanÄ± kontrolÃ¼
        document.getElementById('aciklama').addEventListener('input', function() {
            checkYasakliGiderKalemi(this.value);
        });

        // Kural 3: MÃ¼kerrer Fatura KontrolÃ¼ (SimÃ¼lasyon)
        // GerÃ§ek uygulamada API Ã§aÄŸrÄ±sÄ± ile kontrol edilecek
        const GECMIS_FATURALAR = [
            { firmaAdi: 'KARADENIZ SOFRASI', belgeNo: 'YKF-2024-847520', belgeTarihi: '2024-12-08' },
            { firmaAdi: 'MIGROS', belgeNo: 'F-2024-001234', belgeTarihi: '2024-12-07' }
        ];

        function checkMukerrerFatura() {
            const firmaAdi = document.getElementById('firmaAdi').value.toUpperCase();
            const belgeNo = document.getElementById('belgeNo').value;
            const belgeTarihi = document.getElementById('belgeTarihi').value;

            const alertContainer = document.getElementById('alertContainer');
            const existingMukerrerAlert = document.getElementById('mukerrerAlert');

            const mukerrer = GECMIS_FATURALAR.find(f =>
                f.firmaAdi.toUpperCase() === firmaAdi &&
                f.belgeNo === belgeNo &&
                f.belgeTarihi === belgeTarihi
            );

            if (mukerrer) {
                if (!existingMukerrerAlert) {
                    const alert = document.createElement('div');
                    alert.id = 'mukerrerAlert';
                    alert.className = 'alert alert-error';
                    alert.innerHTML = `
                        <span class="alert-icon">âš ï¸</span>
                        <div>
                            <strong>MÃ¼kerrer Fatura UyarÄ±sÄ±!</strong><br>
                            Bu fatura daha Ã¶nce sisteme girilmiÅŸ gÃ¶rÃ¼nÃ¼yor.<br>
                            <small>Firma: ${firmaAdi} | Belge No: ${belgeNo} | Tarih: ${belgeTarihi}</small>
                        </div>
                    `;
                    alertContainer.appendChild(alert);
                }
                return false;
            } else if (existingMukerrerAlert) {
                existingMukerrerAlert.remove();
            }
            return true;
        }

        // Belge alanlarÄ± deÄŸiÅŸtiÄŸinde mÃ¼kerrer kontrolÃ¼
        ['firmaAdi', 'belgeNo', 'belgeTarihi'].forEach(fieldId => {
            document.getElementById(fieldId).addEventListener('change', checkMukerrerFatura);
        });

        // Kural 4: Åirket EÅŸleÅŸme KontrolÃ¼
        // Ã‡alÄ±ÅŸanÄ±n bordro ÅŸirketi ile fatura ÅŸirketi uyumlu olmalÄ±
        const KULLANICI_BORDRO_SIRKETI = 'flo_teknoloji'; // Ã–rnek: Login'den gelecek
        const SIRKET_VKN_ESLESMESI = {
            'flo_magazacilik': ['1234567890', '9876543210'],
            'flo_teknoloji': ['1111111111', '2222222222'],
            'turuncu': ['3333333333', '4444444444'],
            'flo_ic_dis': ['5555555555', '6666666666']
        };

        function checkSirketEslesmesi() {
            const secilenSirket = document.getElementById('sirket').value;
            const alertContainer = document.getElementById('alertContainer');
            const existingSirketAlert = document.getElementById('sirketAlert');

            if (secilenSirket !== KULLANICI_BORDRO_SIRKETI) {
                if (!existingSirketAlert) {
                    const alert = document.createElement('div');
                    alert.id = 'sirketAlert';
                    alert.className = 'alert alert-warning';
                    alert.innerHTML = `
                        <span class="alert-icon">âš ï¸</span>
                        <div>
                            <strong>Åirket UyumsuzluÄŸu!</strong><br>
                            Bordro ÅŸirketiniz ile seÃ§ilen ÅŸirket farklÄ±.
                            FarklÄ± ÅŸirket adÄ±na masraf giriÅŸi iÃ§in gerekÃ§e belirtmeniz gerekmektedir.
                        </div>
                    `;
                    alertContainer.appendChild(alert);
                }
            } else if (existingSirketAlert) {
                existingSirketAlert.remove();
            }
        }

        document.getElementById('sirket').addEventListener('change', checkSirketEslesmesi);

        // ============================================
        // AI HESAP Ã–NERÄ°SÄ° SÄ°STEMÄ°
        // ============================================

        // AI Hesap Ã¶nerisi keyword eÅŸleÅŸmeleri
        const AI_HESAP_ONERILERI = {
            // Yemek Giderleri - 770.01
            'yemek': { kod: '770.01', aciklama: 'Yemek Giderleri' },
            'restoran': { kod: '770.01', aciklama: 'Yemek Giderleri' },
            'lokanta': { kod: '770.01', aciklama: 'Yemek Giderleri' },
            'kahvaltÄ±': { kod: '770.01', aciklama: 'Yemek Giderleri' },
            'Ã¶ÄŸle yemeÄŸi': { kod: '770.01', aciklama: 'Yemek Giderleri' },
            'akÅŸam yemeÄŸi': { kod: '770.01', aciklama: 'Yemek Giderleri' },
            'cafe': { kod: '770.01', aciklama: 'Yemek Giderleri' },
            'kahve': { kod: '770.01', aciklama: 'Yemek Giderleri' },
            'starbucks': { kod: '770.01', aciklama: 'Yemek Giderleri' },

            // UlaÅŸÄ±m Giderleri - 770.02
            'taksi': { kod: '770.02', aciklama: 'UlaÅŸÄ±m Giderleri' },
            'uber': { kod: '770.02', aciklama: 'UlaÅŸÄ±m Giderleri' },
            'bitaksi': { kod: '770.02', aciklama: 'UlaÅŸÄ±m Giderleri' },
            'transfer': { kod: '770.02', aciklama: 'UlaÅŸÄ±m Giderleri' },
            'havalimanÄ±': { kod: '770.02', aciklama: 'UlaÅŸÄ±m Giderleri' },
            'uÃ§ak': { kod: '770.02', aciklama: 'UlaÅŸÄ±m Giderleri' },
            'otobÃ¼s': { kod: '770.02', aciklama: 'UlaÅŸÄ±m Giderleri' },
            'tren': { kod: '770.02', aciklama: 'UlaÅŸÄ±m Giderleri' },

            // Konaklama Giderleri - 770.03
            'otel': { kod: '770.03', aciklama: 'Konaklama Giderleri' },
            'konaklama': { kod: '770.03', aciklama: 'Konaklama Giderleri' },
            'hotel': { kod: '770.03', aciklama: 'Konaklama Giderleri' },
            'hilton': { kod: '770.03', aciklama: 'Konaklama Giderleri' },
            'marriott': { kod: '770.03', aciklama: 'Konaklama Giderleri' },

            // Ofis/KÄ±rtasiye - 770.04
            'kÄ±rtasiye': { kod: '770.04', aciklama: 'KÄ±rtasiye ve Ofis Malzemeleri' },
            'kalem': { kod: '770.04', aciklama: 'KÄ±rtasiye ve Ofis Malzemeleri' },
            'defter': { kod: '770.04', aciklama: 'KÄ±rtasiye ve Ofis Malzemeleri' },
            'dosya': { kod: '770.04', aciklama: 'KÄ±rtasiye ve Ofis Malzemeleri' },
            'toner': { kod: '770.04', aciklama: 'KÄ±rtasiye ve Ofis Malzemeleri' },
            'kaÄŸÄ±t': { kod: '770.04', aciklama: 'KÄ±rtasiye ve Ofis Malzemeleri' },

            // HaberleÅŸme - 770.05
            'telefon': { kod: '770.05', aciklama: 'HaberleÅŸme Giderleri' },
            'turkcell': { kod: '770.05', aciklama: 'HaberleÅŸme Giderleri' },
            'vodafone': { kod: '770.05', aciklama: 'HaberleÅŸme Giderleri' },
            'internet': { kod: '770.05', aciklama: 'HaberleÅŸme Giderleri' },

            // AkaryakÄ±t - 770.07
            'benzin': { kod: '770.07', aciklama: 'AkaryakÄ±t Giderleri' },
            'motorin': { kod: '770.07', aciklama: 'AkaryakÄ±t Giderleri' },
            'yakÄ±t': { kod: '770.07', aciklama: 'AkaryakÄ±t Giderleri' },
            'shell': { kod: '770.07', aciklama: 'AkaryakÄ±t Giderleri' },
            'opet': { kod: '770.07', aciklama: 'AkaryakÄ±t Giderleri' },
            'petrol': { kod: '770.07', aciklama: 'AkaryakÄ±t Giderleri' }
        };

        let sonAIOnerisi = null;

        // AI Hesap Ã¶nerisi fonksiyonu
        function aiHesapOnerisi(aciklama) {
            const container = document.getElementById('aiHesapOneriContainer');
            const textEl = document.getElementById('aiHesapOneriText');

            if (!aciklama || aciklama.length < 3) {
                container.style.display = 'none';
                sonAIOnerisi = null;
                return;
            }

            const lowercaseAciklama = aciklama.toLowerCase();

            // Keyword eÅŸleÅŸmesi ara
            for (const [keyword, oneri] of Object.entries(AI_HESAP_ONERILERI)) {
                if (lowercaseAciklama.includes(keyword)) {
                    sonAIOnerisi = oneri;
                    textEl.innerHTML = `<strong>${oneri.kod}</strong> - ${oneri.aciklama}`;
                    container.style.display = 'block';
                    return;
                }
            }

            // EÅŸleÅŸme yoksa gizle
            container.style.display = 'none';
            sonAIOnerisi = null;
        }

        // AI Ã¶nerisini uygula
        function aiOneriUygula() {
            if (sonAIOnerisi) {
                const hesapKoduSelect = document.getElementById('hesapKodu');
                hesapKoduSelect.value = sonAIOnerisi.kod;
                hesapKoduSelect.disabled = false; // EÄŸer disabled ise aÃ§

                showAlert('success', `ğŸ¤– AI Ã¶nerisi uygulandÄ±: ${sonAIOnerisi.kod} - ${sonAIOnerisi.aciklama}`);

                // Ã–neri kutusunu gizle
                document.getElementById('aiHesapOneriContainer').style.display = 'none';
            }
        }

        // ============================================
        // CARÄ° KONTROLÃœ VE FORM BLOKLAMA
        // ============================================

        // Cari gerekli fatura kontrolÃ¼
        function checkCariGerekli() {
            const cariGerekliSayisi = belgeler.filter(b => b.belgeTuru === 'fatura' && b.cariDurumu === 'gerekli').length;
            return cariGerekliSayisi;
        }

        // Cari uyarÄ±sÄ±nÄ± gÃ¼ncelle
        function guncelleCariUyarisi() {
            const cariGerekliSayisi = checkCariGerekli();
            const alertContainer = document.getElementById('alertContainer');
            const existingCariAlert = document.getElementById('cariGerekliAlert');
            const submitBtn = document.querySelector('button[onclick="submitMasrafForm()"]');

            if (cariGerekliSayisi > 0) {
                // UyarÄ± gÃ¶ster
                if (!existingCariAlert) {
                    const alert = document.createElement('div');
                    alert.id = 'cariGerekliAlert';
                    alert.className = 'alert alert-error';
                    alert.style.cssText = 'position: sticky; top: 0; z-index: 100;';
                    alert.innerHTML = `
                        <span class="alert-icon">ğŸš«</span>
                        <div>
                            <strong>Cari KaydÄ± Gerekli!</strong><br>
                            <span>${cariGerekliSayisi} adet faturanÄ±n tedarikÃ§isi SAP'da tanÄ±mlÄ± deÄŸil.</span><br>
                            <small style="color: #b71c1c;">Masraf gÃ¶ndermeden Ã¶nce ilgili carilerin aÃ§Ä±lmasÄ± gerekmektedir. LÃ¼tfen Cari Mutabakat birimi ile iletiÅŸime geÃ§iniz.</small>
                        </div>
                    `;
                    alertContainer.prepend(alert);
                }

                // Submit butonunu devre dÄ±ÅŸÄ± bÄ±rak
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.style.opacity = '0.5';
                    submitBtn.style.cursor = 'not-allowed';
                    submitBtn.title = 'Cari kaydÄ± olmayan faturalar mevcut';
                }
            } else {
                // UyarÄ±yÄ± kaldÄ±r
                if (existingCariAlert) {
                    existingCariAlert.remove();
                }

                // Submit butonunu aktif et
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.style.opacity = '1';
                    submitBtn.style.cursor = 'pointer';
                    submitBtn.title = '';
                }
            }
        }

        // Orijinal renderBelgeler fonksiyonunu geniÅŸlet
        const originalRenderBelgeler = renderBelgeler;
        renderBelgeler = function() {
            originalRenderBelgeler();
            guncelleCariUyarisi();
        };

        // Form submit validasyonu
        const originalSubmitMasrafForm = window.submitMasrafForm || function() {};
        window.submitMasrafForm = function() {
            const brutTutar = parseFloat(document.getElementById('brutTutar').value) || 0;
            const aciklama = document.getElementById('aciklama').value;
            const belgeTuru = document.getElementById('belgeTuru').value;

            // Disabled select'in deÄŸerini al (OCR tarafÄ±ndan kilitlenmiÅŸ olabilir)
            const hesapKoduSelect = document.getElementById('hesapKodu');
            const hesapKodu = hesapKoduSelect.value;

            // CARÄ° KONTROLÃœ - En Ã¶nemli kontrol
            const cariGerekliSayisi = checkCariGerekli();
            if (cariGerekliSayisi > 0) {
                showValidationAlert(`${cariGerekliSayisi} adet faturanÄ±n cari kaydÄ± bulunmamaktadÄ±r. Ã–nce carilerin aÃ§Ä±lmasÄ± gerekmektedir.`, 'error');
                return;
            }

            // Zorunlu alan kontrolleri
            if (belgeler.length === 0) {
                showValidationAlert('LÃ¼tfen en az bir belge ekleyiniz.', 'error');
                return;
            }
            if (!aciklama.trim()) {
                showValidationAlert('Masraf aÃ§Ä±klamasÄ± zorunludur.', 'error');
                return;
            }
            if (brutTutar <= 0) {
                showValidationAlert('GeÃ§erli bir tutar giriniz.', 'error');
                return;
            }

            // Kural seti kontrolleri
            if (brutTutar > TUTAR_LIMITI) {
                showValidationAlert('Tutar limiti aÅŸÄ±ldÄ±ÄŸÄ± iÃ§in bu masraf gÃ¶nderilemez.', 'error');
                return;
            }

            if (!checkYasakliGiderKalemi(aciklama)) {
                showValidationAlert('Kabul edilmeyen gider kalemi iÃ§eren masraf gÃ¶nderilemez.', 'error');
                return;
            }

            if (!checkMukerrerFatura()) {
                showValidationAlert('MÃ¼kerrer fatura tespit edildi. LÃ¼tfen kontrol ediniz.', 'error');
                return;
            }

            // TÃ¼m kontroller geÃ§ti, formu gÃ¶nder
            showAlert('success', 'âœ… Masraf talebiniz baÅŸarÄ±yla onaya gÃ¶nderildi!');
            setTimeout(() => {
                window.location.href = 'masraf-listesi.html';
            }, 2000);
        };

        // Alert gÃ¶sterme fonksiyonu (main.js ile uyumlu)
        // Not: main.js'deki showAlert(type, message) fonksiyonunu kullanÄ±yoruz
        // Bu sayfaya Ã¶zel validasyon alertleri iÃ§in ayrÄ± bir fonksiyon tanÄ±mlÄ±yoruz
        function showValidationAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <span class="alert-icon">${type === 'error' ? 'âŒ' : 'âœ…'}</span>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 18px;">Ã—</button>
            `;
            alertContainer.prepend(alert);

            if (type === 'success') {
                setTimeout(() => alert.remove(), 5000);
            }
        }

        // YÃ¶netici gÃ¶rÃ¼nÃ¼mÃ¼ kontrolÃ¼
        function checkManagerView() {
            const urlParams = new URLSearchParams(window.location.search);
            const isManagerRole = urlParams.get('role') === 'manager';

            if (isManagerRole) {
                document.getElementById('sidebarEmployee').style.display = 'none';
                document.getElementById('sidebarManager').style.display = 'block';
            }
        }

    </script>

    <!-- Manuel Belge OluÅŸturma Modal -->
    <div id="manuelBelgeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; overflow-y: auto;">
        <div style="background: white; max-width: 800px; margin: 40px auto; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden;">
            <!-- Modal Header -->
            <div style="background: linear-gradient(135deg, #9C27B0, #7B1FA2); color: white; padding: 20px 24px; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="margin: 0; font-size: 18px;">âœï¸ Manuel Belge OluÅŸtur</h3>
                    <p style="margin: 4px 0 0 0; font-size: 13px; opacity: 0.9;">OCR okuyamadÄ±ÄŸÄ±nda veya manuel giriÅŸ tercih edildiÄŸinde</p>
                </div>
                <button onclick="manuelBelgeModalKapat()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 18px;">âœ•</button>
            </div>

            <!-- Modal Body -->
            <div style="padding: 24px; max-height: 70vh; overflow-y: auto;">
                <!-- Belge TÃ¼rÃ¼ SeÃ§imi -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Belge TÃ¼rÃ¼ *</label>
                    <div style="display: flex; gap: 12px;">
                        <label style="display: flex; align-items: center; gap: 8px; padding: 12px 20px; background: #f5f5f5; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; flex: 1;" id="manuelFisLabel">
                            <input type="radio" name="manuelBelgeTuru" value="fis" checked onchange="manuelBelgeTuruDegisti()">
                            <span style="font-size: 20px;">ğŸ§¾</span>
                            <span style="font-weight: 600;">FiÅŸ</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; padding: 12px 20px; background: #f5f5f5; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; flex: 1;" id="manuelFaturaLabel">
                            <input type="radio" name="manuelBelgeTuru" value="fatura" onchange="manuelBelgeTuruDegisti()">
                            <span style="font-size: 20px;">ğŸ“„</span>
                            <span style="font-weight: 600;">Fatura</span>
                        </label>
                    </div>
                </div>

                <!-- Firma Bilgileri -->
                <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 16px 0; font-size: 14px; color: #666;">ğŸ“ Firma Bilgileri</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div>
                            <label style="display: block; font-weight: 500; margin-bottom: 6px; font-size: 13px;">Firma AdÄ± *</label>
                            <input type="text" id="manuelFirmaAdi" placeholder="Ã–rn: MIGROS TÄ°CARET A.Å." style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                        </div>
                        <div>
                            <label style="display: block; font-weight: 500; margin-bottom: 6px; font-size: 13px;">Vergi No *</label>
                            <input type="text" id="manuelVergiNo" placeholder="10 haneli VKN" maxlength="11" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                        </div>
                    </div>
                </div>

                <!-- Belge Bilgileri -->
                <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 16px 0; font-size: 14px; color: #666;">ğŸ“„ Belge Bilgileri</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div>
                            <label style="display: block; font-weight: 500; margin-bottom: 6px; font-size: 13px;">Belge No *</label>
                            <input type="text" id="manuelBelgeNo" placeholder="FiÅŸ/Fatura numarasÄ±" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                        </div>
                        <div>
                            <label style="display: block; font-weight: 500; margin-bottom: 6px; font-size: 13px;">Belge Tarihi *</label>
                            <input type="date" id="manuelBelgeTarihi" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                        </div>
                    </div>
                </div>

                <!-- Cari Bilgileri (Sadece Fatura iÃ§in) -->
                <div id="manuelCariAlani" style="display: none; background: #FFF3E0; padding: 16px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #FFE0B2;">
                    <h4 style="margin: 0 0 16px 0; font-size: 14px; color: #E65100;">âš ï¸ Cari Bilgileri (Fatura iÃ§in zorunlu)</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div>
                            <label style="display: block; font-weight: 500; margin-bottom: 6px; font-size: 13px;">Cari Durumu</label>
                            <select id="manuelCariDurumu" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box;" onchange="manuelCariDurumuDegisti()">
                                <option value="mevcut">Cari Mevcut</option>
                                <option value="gerekli">Cari Gerekli (Yeni TedarikÃ§i)</option>
                            </select>
                        </div>
                        <div id="manuelCariKoduAlani">
                            <label style="display: block; font-weight: 500; margin-bottom: 6px; font-size: 13px;">Cari Kodu</label>
                            <input type="text" id="manuelCariKodu" placeholder="Ã–rn: 320.01.045" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                        </div>
                    </div>
                </div>

                <!-- Gider SatÄ±rlarÄ± -->
                <div style="background: #E8F5E9; padding: 16px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #C8E6C9;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h4 style="margin: 0; font-size: 14px; color: #2E7D32;">ğŸ’° Gider SatÄ±rlarÄ±</h4>
                        <button type="button" onclick="manuelSatirEkle()" style="background: #4CAF50; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500;">
                            + SatÄ±r Ekle
                        </button>
                    </div>

                    <div id="manuelSatirlarContainer">
                        <!-- VarsayÄ±lan bir satÄ±r -->
                        <div class="manuel-satir" data-satir-index="0" style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; border: 1px solid #ddd;">
                            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 12px; align-items: end;">
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">AÃ§Ä±klama *</label>
                                    <input type="text" class="manuel-satir-aciklama" placeholder="ÃœrÃ¼n/Hizmet aÃ§Ä±klamasÄ±" style="width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">Tutar (TL) *</label>
                                    <input type="number" class="manuel-satir-tutar" placeholder="0.00" step="0.01" style="width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">KDV %</label>
                                    <select class="manuel-satir-kdv" style="width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;">
                                        <option value="0">%0</option>
                                        <option value="1">%1</option>
                                        <option value="10" selected>%10</option>
                                        <option value="20">%20</option>
                                    </select>
                                </div>
                                <button type="button" onclick="manuelSatirSil(this)" style="background: #f44336; color: white; border: none; width: 36px; height: 36px; border-radius: 4px; cursor: pointer; font-size: 16px;" title="SatÄ±rÄ± Sil">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    </div>

                    <!-- Toplam GÃ¶sterimi -->
                    <div style="background: white; padding: 12px 16px; border-radius: 8px; margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 600; color: #333;">Toplam Tutar:</span>
                        <span id="manuelToplamTutar" style="font-size: 20px; font-weight: 700; color: #4CAF50;">â‚º0.00</span>
                    </div>
                </div>

                <!-- Gider Kategorisi -->
                <div style="background: #f8f9fa; padding: 16px; border-radius: 8px;">
                    <h4 style="margin: 0 0 16px 0; font-size: 14px; color: #666;">ğŸ“‚ Gider Kategorisi</h4>
                    <div>
                        <label style="display: block; font-weight: 500; margin-bottom: 6px; font-size: 13px;">Gider Kalemi</label>
                        <select id="manuelGiderKalemi" onchange="manuelGiderKalemiDegisti()" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                            <option value="GÄ±da">ğŸ½ï¸ GÄ±da</option>
                            <option value="Temizlik">ğŸ§¹ Temizlik</option>
                            <option value="KÄ±rtasiye">ğŸ“ KÄ±rtasiye</option>
                            <option value="UlaÅŸÄ±m">ğŸš— UlaÅŸÄ±m</option>
                            <option value="Konaklama">ğŸ¨ Konaklama</option>
                            <option value="TelekomÃ¼nikasyon">ğŸ“± TelekomÃ¼nikasyon</option>
                            <option value="AkaryakÄ±t">â›½ AkaryakÄ±t</option>
                            <option value="DiÄŸer">ğŸ“¦ DiÄŸer</option>
                        </select>
                    </div>
                    <!-- Plaka AlanÄ± (UlaÅŸÄ±m seÃ§ildiÄŸinde gÃ¶rÃ¼nÃ¼r) -->
                    <div id="manuelPlakaAlani" style="display: none; margin-top: 16px;">
                        <label style="display: block; font-weight: 500; margin-bottom: 6px; font-size: 13px;">ğŸš˜ AraÃ§ PlakasÄ±</label>
                        <input type="text" id="manuelPlaka" placeholder="Ã–rn: 34 ABC 123" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box; text-transform: uppercase;" oninput="this.value = this.value.toUpperCase()">
                        <p style="margin: 6px 0 0 0; font-size: 11px; color: #888;">UlaÅŸÄ±m gideri iÃ§in araÃ§ plakasÄ±nÄ± giriniz. OCR ile okunabiliyorsa otomatik dolar.</p>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div style="background: #f5f5f5; padding: 16px 24px; display: flex; justify-content: flex-end; gap: 12px; border-top: 1px solid #e0e0e0;">
                <button type="button" onclick="manuelBelgeModalKapat()" style="background: white; color: #666; border: 1px solid #ddd; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">
                    Ä°ptal
                </button>
                <button type="button" onclick="manuelBelgeKaydet()" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">
                    âœ“ Belgeyi Ekle
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // MANUEL BELGE OLUÅTURMA FONKSÄ°YONLARI
        // ============================================

        let manuelSatirSayaci = 0;

        // Modal aÃ§
        function manuelBelgeModalAc() {
            document.getElementById('manuelBelgeModal').style.display = 'block';
            document.body.style.overflow = 'hidden';

            // VarsayÄ±lan deÄŸerleri ayarla
            document.getElementById('manuelBelgeTarihi').value = new Date().toISOString().split('T')[0];
            manuelBelgeTuruDegisti();
            manuelToplamHesapla();
        }

        // Modal kapat
        function manuelBelgeModalKapat() {
            document.getElementById('manuelBelgeModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            manuelFormuTemizle();
        }

        // Formu temizle
        function manuelFormuTemizle() {
            document.getElementById('manuelFirmaAdi').value = '';
            document.getElementById('manuelVergiNo').value = '';
            document.getElementById('manuelBelgeNo').value = '';
            document.getElementById('manuelBelgeTarihi').value = '';
            document.getElementById('manuelCariKodu').value = '';
            document.getElementById('manuelCariDurumu').value = 'mevcut';

            // Plaka alanÄ±nÄ± temizle ve gizle
            document.getElementById('manuelPlaka').value = '';
            document.getElementById('manuelPlakaAlani').style.display = 'none';

            // SatÄ±rlarÄ± sÄ±fÄ±rla
            const container = document.getElementById('manuelSatirlarContainer');
            container.innerHTML = `
                <div class="manuel-satir" data-satir-index="0" style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; border: 1px solid #ddd;">
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 12px; align-items: end;">
                        <div>
                            <label style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">AÃ§Ä±klama *</label>
                            <input type="text" class="manuel-satir-aciklama" placeholder="ÃœrÃ¼n/Hizmet aÃ§Ä±klamasÄ±" style="width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;">
                        </div>
                        <div>
                            <label style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">Tutar (TL) *</label>
                            <input type="number" class="manuel-satir-tutar" placeholder="0.00" step="0.01" oninput="manuelToplamHesapla()" style="width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;">
                        </div>
                        <div>
                            <label style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">KDV %</label>
                            <select class="manuel-satir-kdv" onchange="manuelToplamHesapla()" style="width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;">
                                <option value="0">%0</option>
                                <option value="1">%1</option>
                                <option value="10" selected>%10</option>
                                <option value="20">%20</option>
                            </select>
                        </div>
                        <button type="button" onclick="manuelSatirSil(this)" style="background: #f44336; color: white; border: none; width: 36px; height: 36px; border-radius: 4px; cursor: pointer; font-size: 16px;" title="SatÄ±rÄ± Sil">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `;
            manuelSatirSayaci = 0;
        }

        // Belge tÃ¼rÃ¼ deÄŸiÅŸti
        function manuelBelgeTuruDegisti() {
            const belgeTuru = document.querySelector('input[name="manuelBelgeTuru"]:checked').value;
            const cariAlani = document.getElementById('manuelCariAlani');

            if (belgeTuru === 'fatura') {
                cariAlani.style.display = 'block';
                document.getElementById('manuelFisLabel').style.borderColor = '#e0e0e0';
                document.getElementById('manuelFisLabel').style.background = '#f5f5f5';
                document.getElementById('manuelFaturaLabel').style.borderColor = '#2196F3';
                document.getElementById('manuelFaturaLabel').style.background = '#E3F2FD';
            } else {
                cariAlani.style.display = 'none';
                document.getElementById('manuelFaturaLabel').style.borderColor = '#e0e0e0';
                document.getElementById('manuelFaturaLabel').style.background = '#f5f5f5';
                document.getElementById('manuelFisLabel').style.borderColor = '#4CAF50';
                document.getElementById('manuelFisLabel').style.background = '#E8F5E9';
            }
        }

        // Gider kalemi deÄŸiÅŸtiÄŸinde plaka alanÄ±nÄ± gÃ¶ster/gizle
        function manuelGiderKalemiDegisti() {
            const giderKalemi = document.getElementById('manuelGiderKalemi').value;
            const plakaAlani = document.getElementById('manuelPlakaAlani');

            if (giderKalemi === 'UlaÅŸÄ±m') {
                plakaAlani.style.display = 'block';
            } else {
                plakaAlani.style.display = 'none';
                document.getElementById('manuelPlaka').value = '';
            }
        }

        // Cari durumu deÄŸiÅŸti
        function manuelCariDurumuDegisti() {
            const cariDurumu = document.getElementById('manuelCariDurumu').value;
            const cariKoduAlani = document.getElementById('manuelCariKoduAlani');

            if (cariDurumu === 'mevcut') {
                cariKoduAlani.style.display = 'block';
            } else {
                cariKoduAlani.style.display = 'none';
            }
        }

        // SatÄ±r ekle
        function manuelSatirEkle() {
            manuelSatirSayaci++;
            const container = document.getElementById('manuelSatirlarContainer');
            const yeniSatir = document.createElement('div');
            yeniSatir.className = 'manuel-satir';
            yeniSatir.dataset.satirIndex = manuelSatirSayaci;
            yeniSatir.style.cssText = 'background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; border: 1px solid #ddd;';
            yeniSatir.innerHTML = `
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 12px; align-items: end;">
                    <div>
                        <label style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">AÃ§Ä±klama *</label>
                        <input type="text" class="manuel-satir-aciklama" placeholder="ÃœrÃ¼n/Hizmet aÃ§Ä±klamasÄ±" style="width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">Tutar (TL) *</label>
                        <input type="number" class="manuel-satir-tutar" placeholder="0.00" step="0.01" oninput="manuelToplamHesapla()" style="width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">KDV %</label>
                        <select class="manuel-satir-kdv" onchange="manuelToplamHesapla()" style="width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;">
                            <option value="0">%0</option>
                            <option value="1">%1</option>
                            <option value="10" selected>%10</option>
                            <option value="20">%20</option>
                        </select>
                    </div>
                    <button type="button" onclick="manuelSatirSil(this)" style="background: #f44336; color: white; border: none; width: 36px; height: 36px; border-radius: 4px; cursor: pointer; font-size: 16px;" title="SatÄ±rÄ± Sil">ğŸ—‘ï¸</button>
                </div>
            `;
            container.appendChild(yeniSatir);
        }

        // SatÄ±r sil
        function manuelSatirSil(btn) {
            const satirlar = document.querySelectorAll('.manuel-satir');
            if (satirlar.length > 1) {
                btn.closest('.manuel-satir').remove();
                manuelToplamHesapla();
            } else {
                alert('En az bir satÄ±r olmalÄ±dÄ±r.');
            }
        }

        // Toplam hesapla
        function manuelToplamHesapla() {
            let toplam = 0;
            const satirlar = document.querySelectorAll('.manuel-satir');

            satirlar.forEach(satir => {
                const tutar = parseFloat(satir.querySelector('.manuel-satir-tutar').value) || 0;
                const kdvOrani = parseInt(satir.querySelector('.manuel-satir-kdv').value) || 0;
                const kdvTutar = tutar * kdvOrani / 100;
                toplam += tutar + kdvTutar;
            });

            document.getElementById('manuelToplamTutar').textContent = 'â‚º' + toplam.toFixed(2);
        }

        // Belgeyi kaydet
        function manuelBelgeKaydet() {
            // Validasyon
            const firmaAdi = document.getElementById('manuelFirmaAdi').value.trim();
            const vergiNo = document.getElementById('manuelVergiNo').value.trim();
            const belgeNo = document.getElementById('manuelBelgeNo').value.trim();
            const belgeTarihi = document.getElementById('manuelBelgeTarihi').value;
            const belgeTuru = document.querySelector('input[name="manuelBelgeTuru"]:checked').value;
            const giderKalemi = document.getElementById('manuelGiderKalemi').value;

            if (!firmaAdi) {
                alert('Firma adÄ± zorunludur.');
                return;
            }
            if (!vergiNo) {
                alert('Vergi numarasÄ± zorunludur.');
                return;
            }
            if (!belgeNo) {
                alert('Belge numarasÄ± zorunludur.');
                return;
            }
            if (!belgeTarihi) {
                alert('Belge tarihi zorunludur.');
                return;
            }

            // SatÄ±rlarÄ± topla
            const satirlarHTML = document.querySelectorAll('.manuel-satir');
            const satirlar = [];
            let hasError = false;

            satirlarHTML.forEach((satir, index) => {
                const aciklama = satir.querySelector('.manuel-satir-aciklama').value.trim();
                const tutar = parseFloat(satir.querySelector('.manuel-satir-tutar').value) || 0;
                const kdvOrani = parseInt(satir.querySelector('.manuel-satir-kdv').value) || 0;

                if (!aciklama || tutar <= 0) {
                    hasError = true;
                    return;
                }

                satirlar.push({
                    kalem: giderKalemi,
                    aciklama: aciklama,
                    hesapKodu: '770.01',
                    netTutar: tutar,
                    kdvOrani: kdvOrani
                });
            });

            if (hasError || satirlar.length === 0) {
                alert('TÃ¼m satÄ±rlarda aÃ§Ä±klama ve tutar girilmelidir.');
                return;
            }

            // FiÅŸ kalemleri oluÅŸtur
            const fisKalemleri = satirlar.map(s => ({
                urun: s.aciklama,
                tutar: 'â‚º' + (s.netTutar + (s.netTutar * s.kdvOrani / 100)).toFixed(2)
            }));

            // Belge objesi oluÅŸtur
            const yeniBelge = {
                belgeTuru: belgeTuru,
                firmaAdi: firmaAdi,
                firmaTuru: 'Manuel GiriÅŸ',
                vergiNo: vergiNo,
                belgeNo: belgeNo,
                belgeTarihi: belgeTarihi,
                ocrGuvenSkoru: 100,
                fisKalemleri: fisKalemleri,
                satirlar: satirlar
            };

            // Fatura ise cari bilgileri ekle
            if (belgeTuru === 'fatura') {
                yeniBelge.cariDurumu = document.getElementById('manuelCariDurumu').value;
                if (yeniBelge.cariDurumu === 'mevcut') {
                    yeniBelge.cariKodu = document.getElementById('manuelCariKodu').value.trim() || 'YENÄ°';
                }
            }

            // Belgeyi ekle
            belgeEkle(yeniBelge);

            // Modal'Ä± kapat
            manuelBelgeModalKapat();

            // BaÅŸarÄ± mesajÄ±
            showAlert('success', `âœï¸ "${firmaAdi}" belgesi manuel olarak eklendi!`);
        }

        // Ä°lk yÃ¼klemede oninput eventlerini ekle
        document.addEventListener('DOMContentLoaded', function() {
            // Ä°lk satÄ±rdaki inputlara event listener ekle
            const ilkSatir = document.querySelector('.manuel-satir');
            if (ilkSatir) {
                const tutarInput = ilkSatir.querySelector('.manuel-satir-tutar');
                const kdvSelect = ilkSatir.querySelector('.manuel-satir-kdv');
                if (tutarInput) tutarInput.addEventListener('input', manuelToplamHesapla);
                if (kdvSelect) kdvSelect.addEventListener('change', manuelToplamHesapla);
            }
        });
    </script>
</body>
</html>
